"use strict";function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _get=function(t,e,s){for(var i=!0;i;){var a=t,r=e,n=s;l=h=o=void 0,i=!1,null===a&&(a=Function.prototype);var l=Object.getOwnPropertyDescriptor(a,r);if(void 0!==l){if("value"in l)return l.value;var o=l.get;return void 0===o?void 0:o.call(n)}var h=Object.getPrototypeOf(a);if(null===h)return void 0;t=h,e=r,s=n,i=!0}},_createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}();!function(t){function e(t){var e=parseInt("0"+t,10);return String(e).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function s(t){var e=t,s=0,i=0;if(e.offsetParent)do s+=e.offsetLeft,i+=e.offsetTop,e=e.offsetParent;while(e);return{left:s,top:i}}function i(t,e){var s=0;return function(){var i=+new Date-s,a=this;i>e&&(s=+new Date,t.apply(a,arguments))}}function a(t,e){var s;return function(){function i(){t.apply(a,arguments),s=null}var a=this;clearTimeout(s),s=setTimeout(i,e)}}function r(t,e,s,i){if(null===t)return[];for(var a=[],r=[],n=0,l=t.length;l>n;n++){var o=t[n];s&&(o=s.call(i,o,n,t)),(e?n&&r===o:-1!==r.indexOf(o))||(e?r=o:r.push(o),a.push(t[n]))}return a}function n(t){return Array.prototype.slice.call(arguments,1).forEach(function(e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])}),t}function l(t){var e,s,i,a,r=0,n=0,l=0,o=0,h=0,c=0,u=0,d=[],p=t.length;if(!p)return null;for(e=0;p>e;e++)d.push(e);for(e=0;p>e;e++)c=d[e],u=t[e],r+=c,n+=u,o+=c*c,l+=c*u,h++;return s=(h*l-r*n)/(h*o-r*r),i=n/h-s*r/h,a=Math.round(p*s+i),a>=0?a:0}function o(t){var e=[];return t.forEach(function(t){var s=n({},t),i=s.segments;delete s.segments,e.push(s),i&&i.length&&i.forEach(function(t){e.push(n({},t))})}),e}function h(t,e){var s,i,a,r=[],l=[];if(t.sequence){var o=t.sequence[e];i={},a=t.formatter||f.formatter,i.key=t.key,i.label=t.label,i.value=o,i.formatted_value=a(o),t.color&&(i.color=t.color),r.push(i)}return t.segments&&(s=d3.zip.apply(null,t.segments.map(function(t){return t.sequence})).map(function(t){return d3.sum(t)}),t.segments.forEach(function(r,o){if(-1!==t.topSegments.indexOf(r)&&!r.hide_tooltip){var h=r.sequence[e];i={},a=r.formatter||t.formatter||f.formatter,n(i,r),i.label=r.label,i.value=h,i.formatted_value=a(h),i.percentage=Math.round(h/s[e]*100)||0,i.color=r.color||t.colors(o).toString(),l.push(i)}}),l.length&&r.length?r[0].segments=l:r=r.concat(l)),r}function c(t){d3.select(window).on("resize.shart"+I++,a(function(){t.draw()},50))}var u,d,p={version:"1.0.0"},f={},g=40,v=20,y=d3.time.format("%b %e"),m=d3.time.format("%I%p"),x=d3.time.format("%x"),b=d3.time.format("%m/%y");d={hourly:{ticks:24,formatter:m,ruleTicks:3},daily:{ticks:30,formatter:y,ruleTicks:7},weekly:{ticks:8,formatter:x,ruleTicks:1},monthly:{ticks:6,formatter:b,ruleTicks:1},none:{ticks:0,formatter:function(t){return t},ruleTicks:0}};var k=function(){function t(e,s,i){_classCallCheck(this,t),this.id=t.uniqueId(),this.el=d3.select(e),this.series=s||[],this.options=i||{}}return _createClass(t,[{key:"draw",value:function(){}},{key:"update",value:function(t){this.series=t}},{key:"destroy",value:function(){}}]),t}();k.lastUniqueId=0,k.uniqueId=function(){return k.lastUniqueId++};var w=function(){function t(e){_classCallCheck(this,t),this.data=e}return _createClass(t,[{key:"draw",value:function(t){var e=this.data;t.svg.append("svg:rect").attr("x",t.x(e.x)).attr("y",t.y(e.y)).attr("width",t.x(e.w-1)-g).attr("height",t.y(0)-t.y(e.h)).attr("stroke",e.color).attr("fill",e.color)}}]),t}(),_=function(){function t(e,s,i){_classCallCheck(this,t),this.key=e.key,this.label=e.label,this.color=e.color,this.sequence=e.sequence,this.segments=e.segments,this.invisible=!0,this.formatter=e.formatter||i.formatter}return _createClass(t,[{key:"draw",value:function(){}}]),t}(),q=function(){function t(e,s,i){_classCallCheck(this,t);var a=this;this.key=e.key,this.label=e.label,this.color=e.color,this.sequence=e.sequence,this.segments=e.segments,this.lineSegments=this.segments||[e],this.colors=i.colors||f.colors,this.formatter=e.formatter||i.formatter,this.lineSegments.forEach(function(t){0===t.sequence[t.sequence.length-1]&&e.extrapolate_last&&(t.sequence.pop(),t.sequence.push(l(t.sequence))),t.label=t.label,t.dasharray=t.dasharray||e.dasharray,t.strokewidth=t.strokewidth||e.strokewidth||2,t.interpolate=t.interpolate||e.interpolate,a.interpolate&&t.sequence.map(function(e,s){0===e&&(t.sequence[s]=l(t.sequence.slice(0,s)))},t),t.cardinality=e.sequence.length,a.cardinality=d3.max([a.cardinality||0,t.cardinality])}),this.lineSegments&&(this.topSegments=this.lineSegments.slice(0).sort(function(t,e){return d3.descending(d3.sum(t.sequence),d3.sum(e.sequence))}).slice(0,10))}return _createClass(t,[{key:"max",value:function(){return d3.max(this.lineSegments.map(function(t){return d3.max(t.sequence)}))}},{key:"draw",value:function(t){var e=this;this.lineSegments.forEach(function(s,i){if(-1!==e.topSegments.indexOf(s)){var a,r,n,l,o,h=s.sequence.map(function(t,e){return{x:e,y:t}});o=s.color||e.colors(i).toString(),s.fill&&(r=d3.svg.area().x(function(e){return t.x(e.x)}).y0(t.y(t.yRange[0])).y1(function(e){return t.y(e.y)}),l=t.svg.append("svg:path").attr("d",r(h)).attr("transform","translate(0,-1)"),"boolean"==typeof s.fill?l.attr("fill",o).attr("fill-opacity",.3):l.attr("fill",s.fill)),a=d3.svg.line().x(function(e){return t.x(e.x)}).y(function(e){return t.y(e.y)}),n=t.svg.append("svg:path").attr("d",a(h)).attr("transform","translate(0,-1)").attr("stroke",o).attr("stroke-width",s.strokewidth||e.strokewidth).attr("fill","transparent"),(s.dasharray||e.dasharray)&&n.attr("stroke-dasharray",s.dasharray||e.dasharray)}})}}]),t}(),T=function(){function t(e,s,i){if(_classCallCheck(this,t),this.key=e.key,this.label=e.label,this.color=e.color,this.sequence=e.sequence,this.cardinality=e.sequence.length,this.percent=e.percent,this.interpolate=e.interpolate,this.segments=e.segments,this.formatter=e.formatter||i.formatter,this.segments&&(this.topSegments=this.segments.slice(0).sort(function(t,e){return d3.descending(d3.sum(t.sequence),d3.sum(e.sequence))}).slice(0,10)),this.interpolate){var a=[],r=this.segments?d3.zip.apply(null,this.segments.map(function(t){return t.sequence})):d3.zip(this.sequence);r.forEach(function(t,e){0===d3.sum(t)&&a.push(e)},this),this.segements?this.segments.map(function(t,e){t.sequence.map(function(t,s){-1!==a.indexOf(s)&&(this.segments[e].sequence[s]=l(this.segments[e].sequence.slice(0,s)))},this)},this):this.sequence.map(function(t,e){-1!==a.indexOf(e)&&(this.sequence[e]=l(this.sequence.slice(0,e)))},this)}}return _createClass(t,[{key:"max",value:function(){if(this.percent)return 100;var t=this.segments?d3.zip.apply(null,this.segments.map(function(t){return t.sequence})):d3.zip(this.sequence);return d3.max(t.map(function(t){return d3.sum(t)}))}},{key:"sequenceData",value:function(){var t=this.segments?this.segments.map(function(t,e){var s=t.color||f.colors(e).toString();return t.sequence.map(function(e,i){return{x:i,y:e,value:e,label:t.label,color:s}})}):[this.sequence.map(function(t,e){return{x:e,y:t,value:t,label:this.label,color:this.color||f.colors(e).toString()}},this)];return t=d3.layout.stack().offset(this.percent?"expand":"zero").order("reverse")(t),this.sequenceData=function(){return t},t}},{key:"draw",value:function(t){var e,s=this.sequenceData(),i=this;e=d3.svg.area().x(function(e){return t.x(e.x)}).y0(function(e){if(i.percent){var s=t.yAxis?t.y(0)-v:t.y(0);return t.y(0)-s*e.y0}return t.y(e.y0)}).y1(function(e){if(i.percent){var s=t.yAxis?t.y(0)-v:t.y(0);return t.y(0)-s*(e.y0+e.y)}return t.y(e.y0+e.y)}),s.forEach(function(s){t.svg.append("svg:path").attr("d",e(s)).attr("fill",s[0].color).attr("stroke-width",0).attr("stroke",s[0].color)})}}]),t}(),C=function(){function t(e,s,i){_classCallCheck(this,t),this.key=e.key,this.label=e.label,this.sequence=e.sequence,this.percent=e.percent,this.color=e.color||f.colors(s).toString(),this.cardinality=e.sequence.length,this.spacing=e.spacing||8,this.col_width=e.col_width,this.segments=e.segments,this.formatter=e.formatter||i.formatter,this.segments&&(this.topSegments=this.segments.slice(0).sort(function(t,e){return d3.descending(d3.sum(t.sequence),d3.sum(e.sequence))}).slice(0,10))}return _createClass(t,[{key:"max",value:function(){return T.prototype.max.apply(this,arguments)}},{key:"sequenceData",value:function(){var t=this.segments?this.segments.map(function(t,e){var s=t.color||f.colors(e).toString();return t.sequence.map(function(e,i){return{x:i,y:e,value:e,label:t.label,color:s}}).sort(function(){})}):[this.sequence.map(function(t,e){return{x:e,y:t,value:t,label:this.label,color:this.color||f.colors(e).toString()}},this)];return t=d3.layout.stack().offset(this.percent?"expand":"zero")(t),this.sequenceData=function(){return t},t}},{key:"draw",value:function(t){var e,s,i,a,r,n,l=this.sequenceData(),o=this.sequence,h=this.percent;this.col_width?e=this.col_width:(e=t.width,e=Math.floor((e-this.spacing*l[0].length)/l[0].length));var c=t.height-2*v;r=c,h||(n=1,this.sequence.forEach(function(t){t>n&&(n=t)}),r=c/n);var u=function(n){0!==o[n.x]&&(a=n.y0*r+v,h||(a+=c-o[n.x]*r),s=n.y*r,i=t.x(n.x)-e/2,t.svg.append("svg:rect").attr("x",i).attr("y",a).attr("width",e).attr("height",s).attr("stroke-width",0).attr("fill",n.color))};l.forEach(function(t){t.forEach(u,this)})}}]),t}();u={invisible:_,line:q,area:T,column:C};var A=function(t){function e(t,r,n){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t,r,n);var l,o=this.options,h=this;this.dateAxis=o.dateAxis||"daily",this.dateAxisTicks=o.dateAxisTicks,this.yAxis=o.yAxis,this.xAxis=o.xAxis,this.colors=o.colors||f.colors,this.el.style("position","relative"),"none"!==this.dateAxis?(this.startTime=new Date(o.startTime),this.endTime=new Date(o.endTime)):this.xAxis?(this.startTime=1,this.endTime=this.xAxis.length,this.ticks={x:this.xAxis.length}):(this.startTime=o.startTime,this.endTime=o.endTime),this.dateAxisTicks&&(this.ticks={x:this.dateAxisTicks}),this.ticks=this.ticks||{x:d[o.dateAxis].ticks},this.ruleTicks={x:o.ruleTicks||d[o.dateAxis].ruleTicks},this.dateFormatter=d[o.dateAxis].formatter,this.formatter=o.formatter||f.formatter,this.series=this.series.map(function(t,e){return new u[t.type](t,e,h)}),this.bands=(o.bands||[]).map(function(t){return new w(t)}),l=d3.max(this.series.map(function(t){return t.invisible?0:t.max()}))||1,this.tickFormat=o.tickFormat||",",this.yRange=o.yRange||[o.yBase||0,l],this.xTickPadding=o.xTickPadding||0,this.tooltip=o.tooltip||f.tooltip,this.tooltip&&(this.el.on("mousemove",i(function(){if(h.x){var t,e,i,a,r=this,n=s(r);t=Math.round(h.x.invert(d3.event.pageX-n.left));var l=h.timeScaleTicks&&h.timeScaleTicks.length-1;l&&(t=Math.min(Math.max(t,0),l)),e=h.x(t),i=h.tooltipData(t),i.series&&(a=h.tooltip(h,i)),a&&(h.scrubber.style({height:h.y.range()[0]-h.y.range()[1]+"px",visibility:"visible",left:e+"px",top:h.y.range()[1]+"px"}),f.showTooltip({body:a,target:h.scrubber.node(),chart:h.el.node()}))}},50)),this.el.on("mouseleave",a(function(){f.hideTooltip({target:h.scrubber.node()}),h.scrubber.style("visibility","hidden")},100)))}return _inherits(e,t),_createClass(e,[{key:"draw",value:function(){var t,e,s,i,a,n,l,o,h=this,c=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("linear"),u=4.5,d=5;if(this.el.html("").classed("shart-series-graph",!0).style("width","").style("height",""),this.width=t=parseInt(this.el.style("width"),10)||600,this.height=e=parseInt(this.el.style("height"),10)||180,(this.dateAxis||this.xAxis)&&this.el.classed("x-axis",!0),this.dateAxis||this.xAxis?(s=[g+this.xTickPadding,t-g-this.xTickPadding],a=[g,t-g]):(s=[this.xTickPadding,t-this.xTickPadding],a=[0,t]),this.yAxis?(this.el.classed("y-axis",!0),i=[e-v,v]):i=[e,0],n="none"!==this.dateAxis?d3.time.scale:d3.scale.linear,this.svg=this.el.append("svg:svg").attr("width",t).attr("height",e),this.x=d3.scale.linear().domain([0,this.series[0].cardinality-1]).rangeRound(s),this.x_axis=d3.scale.linear().domain([0,this.series[0].cardinality-1]).rangeRound(a),this.y=d3.scale.linear().domain(this.yRange).rangeRound(i),this.timeScale=n().domain([this.startTime,this.endTime]).range(s),this.timeScaleTicks=r(this.timeScale.ticks(this.ticks.x).concat([this.endTime]),!0,function(t){return t.valueOf()}),this.dateAxis||this.xAxis){var p=this.svg.append("svg:g");l={x:this.x_axis(0),y:this.y(this.yRange[0])+u},o={x:this.x_axis.range()[1]+u,y:l.y},p.append("svg:path").attr("d",c([l,o])).attr({"stroke-width":1,stroke:"#aaaaaa"}),this.timeScaleTicks.forEach(function(t,e){this.xAxis&&(t=this.xAxis[e]);var s;if(s="daily"===this.dateAxis&&t.getDay?1===t.getDay():e%this.ruleTicks.x===0){var i=Math.round(this.x(e))+.5,a={x:i,y:this.y(this.yRange[0])+d+u},r={x:i,y:this.y(this.yRange[0])+u};p.append("svg:path").attr("d",c([a,r])).attr("stroke-width",1).attr("stroke","#aaaaaa"),p.append("svg:text").text(this.dateFormatter(t)).attr("x",i).attr("y",a.y+6).attr("font-size",9).attr("text-anchor","middle").attr("fill","#333")}},this)}if(this.yAxis){var f,y=this.yAxis instanceof Array,m=d3.scale.linear().domain([0,this.y.domain()[1]-this.y.domain()[0]]).range(this.y.range()),x=this.svg.append("svg:g");if(y)f=this.yAxis,l={x:this.x_axis.range()[1]+u,y:m(0)+u},o={x:l.x,y:m.range()[1]},x.append("svg:path").attr("d",c([l,o]));else{var b=this.y.domain();f=d3.max(b)-d3.min(b)<2&&"%"!==this.tickFormat?b:[this.y.domain()[0],Math.round(this.y.domain()[1]/2*100)/100,this.y.domain()[1]],l={x:this.x_axis.range()[1]+u,y:this.y(0)+u},o={x:l.x,y:this.y.range()[1]}}x.append("svg:path").attr("d",c([l,o])).attr("stroke-width",1).attr("stroke","#aaaaaa");var k=Math.floor((this.y.domain()[1]-this.y.domain()[0])/(f.length-1));f.forEach(function(t,e){if(null!==t){var s,i,a,r=d3.format(this.tickFormat);s=y?Math.round(m(e*k))+.5:Math.round(this.y(t))+.5,l={x:this.x_axis.range()[1]+u,y:s},o={x:l.x+d,y:l.y},i=x.append("svg:path").attr("d",c([l,o])).attr("stroke-width",1).attr("stroke","#aaaaaa"),a="string"==typeof t?d3.requote(t):r(t),x.append("svg:text").text(a).attr("x",o.x+2).attr("y",s).attr("font-size",9).attr("text-anchor","right").attr("alignment-baseline","middle").attr("fill","#333")}},this)}return this.bands.forEach(function(t){t.draw(this)},this),this.series.forEach(function(t){t.draw(this)},this),this.scrubber=this.el.append("div").classed("shart-scrubber",!0),h}},{key:"tooltipData",value:function(t){var e,s={},i=[];try{e=this.timeScaleTicks[t]}catch(a){}return e&&(s.date=e,s.formatted_date=this.dateFormatter(s.date)),this.series.forEach(function(e){i=i.concat(h(e,t))}),s.series=i,s}}]),e}(k),z=function(t){function e(t,s,i){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t,s,i);var a=this.options;this.width=a.width||120,this.height=a.height||40,this.yGuides=a.y_guides||[],a.y_guide&&this.yGuides.push(a.y_guide),this.strokeColor=a.stroke_color||a.color||"blue",this.strokeWidth=a.stroke_width||1}return _inherits(e,t),_createClass(e,[{key:"draw",value:function(){var t={left:0,top:2,right:0,bottom:2},e=this.width,s=this.height,i=this.yGuides,a=this.series,r=this.strokeColor,n=this.strokeWidth,l=d3.max(a),o=d3.min([0].concat(a)),h=a.length,c=d3.scale.linear().domain([0,h-1]).range([t.left,e-t.left-t.right]),u=d3.scale.linear().domain([o,l]).range([s-t.top-t.bottom,t.top]),d=d3.svg.line().x(function(t,e){return c(e)}).y(function(t){return u(t)}),p=this.el.classed("shart-sparkline-graph",!0).html(""),f=p.append("svg").attr("width",e).attr("height",s);f.append("clipPath").attr("id","clip").append("rect").attr("x",0).attr("y",0).attr("width",e).attr("height",s),f.selectAll(".shart-sparkline-graph-y-guide").data(i).enter().append("line").classed("shart-sparkline-graph-y-guide",!0).attr("clip-path","url(#clip)").attr("x1",c(0)).attr("y1",function(t){return Math.floor(u(t))+.5}).attr("x2",c(h-1)).attr("y2",function(t){return Math.floor(u(t))+.5}).attr("fill","none").attr("stroke","#ddd").attr("stroke-width",1).attr("stroke-linecap","butt"),f.append("path").classed("shart-sparkline-graph-stroke",!0).attr("clip-path","url(#clip)").attr("d",d(a)).attr("fill","none").attr("stroke",r).attr("stroke-width",n).attr("stroke-linecap","butt")}}]),e}(k),S=function(t){function e(t,s,i){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t,s,i);var a=this.options;this.size=a.size||50}return _inherits(e,t),_createClass(e,[{key:"sequenceData",value:function(){var t=d3.layout.pie().value(function(t){return t.value})(this.series);return this.sequenceData=function(){return t},t}},{key:"draw",value:function(){var t=this.size,e=t/2-1,s=d3.svg.arc().outerRadius(e),i=this.sequenceData(),a=this.el.classed("shart-pie-graph",!0).style({position:"relative",width:this.size+"px",height:0,"padding-bottom":this.size+"px"}).html(""),r=a.append("svg:svg").attr("width",this.size).attr("height",this.size).attr("viewBox",[0,0,t,t].join(" ")).style({position:"absolute",left:0,top:0});i.forEach(function(t,i){if(0!==t.value){var a=this.series[i].color||f.colors(i).toString();r.append("svg:path").attr("d",s(t)).attr("transform","translate("+(e+1)+","+(e+1)+")").attr("fill",a).attr("stroke",a)}},this)}}]),e}(k),O=function(t){function s(t,i,a){_classCallCheck(this,s),_get(Object.getPrototypeOf(s.prototype),"constructor",this).call(this,t,i,a);var r=a;this.size=r.size||parseInt(this.el.style("width"),10),this.radius=this.size/2,this.thickness=r.thickness||Math.round(this.radius/7),this.value=r.value,this.value_text="undefined"==typeof r.value_text?e(this.value):r.value_text,this.value_color=r.value_color,this.label=r.label,this.label_position=r.label_position||"center",this.label_color=r.label_color,this.label_subtext=r.label_subtext,this.color=r.color||"gray",this.total=r.total,this.series.length||(this.series=[{value:this.value,color:this.color}]),this.type=r.type||"small"}return _inherits(s,t),_createClass(s,[{key:"draw",value:function(){for(var t,e,s=d3.layout.pie().sort(null).startAngle(0).value(function(t){return t.value}),i=this.series,a=this.total,r=this.radius-this.thickness,n=this.radius,l=function(){return d3.svg.arc().innerRadius(r).outerRadius(n)},o=0,h=0;h<i.length;h++)o+=i[h].value;this.total?s.endAngle(2*Math.PI*o/a):a=o,this.el.classed("shart-donut-graph",!0).style("width",this.size+"px").style("height",this.size+"px").html(""),this.type&&this.el.classed(this.type,!0);var c=this.el.append("div").style("position","relative").style("width",this.size+"px").style("height",this.size+"px"),u=c.append("svg:svg").attr("width",this.size).attr("height",this.size);if(u.append("svg:path").classed("shart-donut-graph-background",!0).attr("fill","#e5e5e5").attr("transform","translate("+this.radius+","+this.radius+")").attr("d",l().startAngle(0).endAngle(2*Math.PI)()),u.append("svg:g").selectAll(".shart-donut-graph-arc").data(s(this.series)).enter().append("svg:path").classed("shart-donut-graph-arc",!0).attr("transform","translate("+this.radius+","+this.radius+")").attr("fill",function(t){return t.data.color}).attr("d",l()),this.label&&"center"===this.label_position){var d=c.append("div").style("position","absolute").style("display","table").style("top",this.thickness+"px").style("left",this.thickness+"px").style("width",this.size-2*this.thickness+"px").style("height",this.size-2*this.thickness+"px"),p=d.append("div").style("display","table-cell").style("text-align","center").style("vertical-align","middle");t=p.append("div").classed("shart-donut-graph-value",!0).text(this.value_text),e=p.append("div").classed("shart-donut-graph-label",!0).style("text-align","center").text(this.label)}else{t=c.append("div").classed("shart-donut-graph-value",!0).style("white-space","nowrap").style("overflow","visible").style("display","inline-block").text(this.value_text);var f={width:parseInt(t.style("width"),10),height:parseInt(t.style("height"),10)};if(t.style("position","absolute").style("left",(this.size-f.width)/2+"px").style("top",(this.size-f.height)/2+"px"),this.label){var g=this.size;e=c.append("div").classed("shart-donut-graph-label",!0).style("white-space","nowrap").style("overflow","visible").style("display","inline-block").text(this.label),this.label_subtext&&(e.node().appendChild(document.createTextNode(" ")),e.append("span").classed("shart-donut-graph-label-subtext",!0).text(this.label_subtext));var v={width:parseInt(e.style("width"),10),height:parseInt(e.style("height"),10)},y=v.height/2;e.style("position","absolute").style("left",this.size+y+"px").style("top",(this.size-v.height)/2+"px"),g+=y+v.width,u.attr("width",g+"px"),this.el.style("width",g+"px")}t&&this.value_color&&t.style("color",this.value_color),e&&this.label_color&&e.style("color",this.label_color)}}}]),s}(k),P=function(t){function s(t,e,i){_classCallCheck(this,s),_get(Object.getPrototypeOf(s.prototype),"constructor",this).call(this,t,e,i);var a=this.options;this.size=a.size||44,this.thickness=a.thickness,this.total=a.total,this.label_subtext=a.label_subtext||""}return _inherits(s,t),_createClass(s,[{key:"draw",value:function(){var t,s=this.series,i=this.total;if(!i)for(i=0,t=0;t<s.length;t++)i+=s[t].value;for(this.el.classed("shart-donut-stack-graph",!0).html(""),t=0;t<s.length;t++){var a=this.el.append("div").classed("shart-donut-stack-graph-item",!0),r=e(s[t].value);this.label_subtext&&(r+=" "+this.label_subtext);var n=new O(a.node(),[],{total:i,value:s[t].value,value_text:e(Math.round(100*s[t].value/i))+"%",value_color:s[t].color,label:s[t].label,label_position:"right",label_subtext:r,color:s[t].color,size:this.size,thickness:this.thickness});n.el.classed("shart-donut-stack-graph-item-donut-graph"),n.draw()}}}]),s}(k),M=function(t){function e(t,s,i){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t,s,i);var a=this.options;this.percentages=a.percentages}return _inherits(e,t),_createClass(e,[{key:"draw",value:function(){var t=d3.sum(this.series,function(t){return t.value}),e=d3.scale.linear().domain([0,d3.max(this.series,function(t){return t.value})]).range([0,100]),s=d3.scale.linear().domain([0,t]).range([0,100]);this.el.classed("shart-horizontal-bar-graph",!0);var i=this.el.selectAll(".shart-horizontal-bar-graph-segment").data(this.series).enter().append("div").classed("shart-horizontal-bar-graph-segment",!0),a=i.append("div").classed("shart-horizontal-bar-graph-label",!0);a.text(this.percentages?function(e){var i=Math.round(s(e.value||0));return 0===t&&(i="--"),i+"% "+e.label}:function(t){return t.label}),a.append("span").classed("shart-horizontal-bar-graph-label-subtext",!0).text(function(t){return t.label_subtext}),i.append("div").classed("shart-horizontal-bar-graph-value",!0).append("div").classed("shart-horizontal-bar-graph-value-bar",!0).style("background-color",function(t){return t.color}).style("width",function(t){return e(t.value||0)+"%"}).style("min-width","1px")}}]),e}(k),E=function(t){function e(t,s,i){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t,s,i);var a=this.options;this.svg=this.el.append("svg"),this.labels=!!s[0].label,this.label_subtext=!!s[0].label_subtext,this.colors=a.colors||f.colors,this.tooltip=a.tooltip||f.tooltip,this.formatter=a.formatter||f.formatter}return _inherits(e,t),_createClass(e,[{key:"draw",value:function(){var t,e,s=this,i=s.svg,a=35,r={label:18,label_subtext:16,bar:a+8},n=d3.sum(this.series,function(t){return t.value}),l=0===n,o=function(t){return d3.format("%")(t)};this.el.classed("shart-pipeline-graph",!0),i.attr("width",0),t=s.width=parseInt(this.el.style("width"),10),e=s.height=r.label+r.label_subtext+r.bar,i.attr("width",t).attr("height",e),l&&i.attr("opacity","0.25"),this.svg.html("");var h=0,c=this.series.length-1;this.series.forEach(function(t,e,i){t.x=h,t.percentage=l?1/i.length:t.value/n,t.width=e===c?s.width-h:Math.floor(t.percentage*s.width),t.color=t.color||s.colors(e),h+=t.width});var u=i.append("defs").selectAll("clipPath").data(this.series);u.enter().append("clipPath").attr("id",function(t,e){return"clip-"+s.id+"-"+e}).append("rect").attr("width",function(t){return t.width}).attr("height",e),u.exit().remove();var d=i.selectAll(".shart-pipeline-graph-item").data(this.series);d.exit().remove();var p=d.enter().append("g").attr("class","shart-pipeline-graph-item").attr("transform",function(t){return"translate("+t.x+",0)"}).attr("clip-path",function(t,e){return"url(#clip-"+s.id+"-"+e+")"});this.labels?p.append("text").attr("class","shart-pipeline-graph-item-label").attr("x",2).attr("y",r.label).text(function(t){var e=o(t.percentage);return l&&(e="--%"),e+" "+t.label}):r.label=0,this.label_subtext?p.append("text").attr("class","shart-pipeline-graph-item-label-subtext").attr("x",2).attr("y",r.label+r.label_subtext).text(function(t){return t.label_subtext}):r.label_subtext=0,this.height=e=r.label+r.label_subtext+r.bar,i.attr("height",e),p.append("rect").attr("class","shart-pipeline-graph-item-bar").attr("fill",function(t){return t.color}).attr("y",r.label+r.label_subtext+r.bar-a).attr("width",function(t){return t.width}).attr("height",a),this.attachMouseEvents()}},{key:"attachMouseEvents",value:function(){var t=this,e=t.svg,s=-1;this.el.on("mousemove",i(function(){var i=d3.mouse(e.node())[0],a=e.selectAll(".shart-pipeline-graph-item");a.each(function(e,r){var n=d3.select(this),l=n.select("rect"),o=parseInt((/\d+/.exec(n.attr("transform"))||["0"])[0],10),h=parseInt(l.attr("width"),10);if(r!==s&&i>=o&&o+h>i){if(s>-1){var c=a.filter(function(t,e){return e===s});t.mouseleave(c,c.datum(),s)}t.mouseenter(n,e,r),s=r}})},40)),this.el.on("mouseleave",function(){if(s>-1){var i=e.selectAll(".shart-pipeline-graph-item"),a=i.filter(function(t,e){return e===s});t.mouseleave(a,a.datum(),s),s=-1}}),this.attachMouseEvents=function(){}}},{key:"mouseenter",value:function(t,e,s){var i,a=this,r=this.svg,n=e.color,l=10,o=0;if(t.select("rect").attr("fill",d3.lab(n).brighter(.3).toString()),this.labels&&this.label_subtext?o=Math.max(t.select(".shart-pipeline-graph-item-label").node().getComputedTextLength(),t.select(".shart-pipeline-graph-item-label-subtext").node().getComputedTextLength())+l:(this.labels&&(o=t.select(".shart-pipeline-graph-item-label").node().getComputedTextLength()+l),this.label_subtext&&(o=t.select(".shart-pipeline-graph-item-label-subtext").node().getComputedTextLength()+l)),o=Math.ceil(o),e.width<o){var h=e.width,c=o-h,u=r.selectAll(".shart-pipeline-graph-item"),d=0,p=u[0].length-1;u.each(function(t,e){var i=d3.select(this),n=i.select("rect"),l=r.select("#clip-"+a.id+"-"+e).select("rect"),h=e===s?o:Math.floor(t.percentage*(a.width-c));e===p&&(h=a.width-d),i.transition().duration(200).attr("transform","translate("+d+",0)"),n.transition().duration(200).attr("width",h),l.transition().duration(200).attr("width",h),d+=h})}e.formatted_value||(e.formatted_value=this.formatter(e.value)),i=a.tooltip(a,{series:[e]}),i&&f.showTooltip({body:i,position:"bottom",target:t.select("rect").node(),chart:a.el.node()})}},{key:"mouseleave",value:function(t,e,s){var i=this,a=this.svg,r=parseInt(a.select("#clip-"+i.id+"-"+s).select("rect").attr("width"),10),n=e.color;if(e.width<r){var l=a.selectAll(".shart-pipeline-graph-item");l.each(function(t,e){var s=d3.select(this),r=s.select("rect"),n=a.select("#clip-"+i.id+"-"+e).select("rect");s.transition().duration(200).attr("transform","translate("+t.x+",0)"),r.transition().duration(200).attr("width",t.width),n.transition().duration(200).attr("width",t.width)})}t.select("rect").attr("fill",n),f.hideTooltip({target:t.select("rect").node()})}}]),e}(k),D=function(t){function e(){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return _inherits(e,t),_createClass(e,[{key:"draw",value:function(){this.el.classed("shart-legend",!0),this.update(this.series)}},{key:"update",value:function(t,e){this.series=t;var s=this.el.selectAll(".shart-legend-item").data(t),i=s.exit(),a=s.enter().append("div").classed("shart-legend-item",!0);a.filter(function(t){return!!t.color}).append("span").classed("shart-swatch shart-legend-item-swatch",!0).style("background-color",function(t){return t.color}),a.append("span").classed("shart-legend-item-label",!0).text(function(t){return t.label}),a.append("span").classed("shart-legend-item-value",!0).text(function(t){return t.formatted_value||t.value}),e?(i.transition().style("opacity",0).remove(),a.style("opacity",0).transition().duration(1e3).style("opacity",1)):i.remove()}}]),e}(k),I=0;f.colors=d3.scale.category10();var j=d3.format(",");f.formatter=function(t){return t||0===t?j(t):"--"},f.showTooltip=function(){},f.hideTooltip=function(){},f.tooltip=function(t,e){var s,i,a,r,n=d3.select(document.createElement("div")),l=o(e.series);if(1===l.length){var h=l[0];s=n.append("div").classed("shart-tip-placard",!0),s.append("div").classed("shart-tip-placard-value",!0).text(h.formatted_value||h.value),s.append("div").classed("shart-tip-placard-label",!0).text(h.tip_label||h.label)}else i=n.append("div"),r=new D(i.node(),l),r.draw();return e.date&&(a=n.append("div").classed("shart-tip-date",!0).text(t.dateFormatter(e.date))),n.node()},p.configure=function(t){var e={};t(e),f.colors=e.colors||f.colors,f.showTooltip=e.showTooltip||f.showTooltip,f.hideTooltip=e.hideTooltip||f.hideTooltip,f.tooltip=e.tooltip||f.tooltip,f.formatter=e.formatter||f.formatter},p.Legend=function(t,e,s){var i=new D(t,e,s);return i.draw(),i},p.Series=function(t,e,s){var i=new A(t,e,s);return c(i),i.draw(),i},p.Sparkline=function(t,e,s){var i=new z(t,e,s);return i.draw(),i},p.Pie=function(t,e,s){var i=new S(t,e,s);return i.draw(),i},p.Donut=function(t,e,s){var i=new O(t,e,s);return c(i),i.draw(),i},p.DonutStack=function(t,e,s){var i=new P(t,e,s);return c(i),i.draw(),i},p.HorizontalBar=function(t,e,s){var i=new M(t,e,s);return c(i),i.draw(),i},p.Pipeline=function(t,e,s){var i=new E(t,e,s);return c(i),i.draw(),i},"function"==typeof define&&define.amd?define(p):"object"==typeof module&&module.exports?module.exports=p:window&&(window.Shart=p)}(void 0);