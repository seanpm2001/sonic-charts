/**
 * sonic-charts - D3 charting library made by UserVoice
 * @version v1.0.0
 * @link https://github.com/uservoice/sonic-charts
 * @license MIT
 */
!function(t){"use strict";function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t){var e=parseInt("0"+t,10);return String(e).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function a(t){var e=t,i=0,s=0;if(e.offsetParent)do i+=e.offsetLeft,s+=e.offsetTop,e=e.offsetParent;while(e);return{left:i,top:s}}function n(t,e){var i=0;return function(){var s=+new Date-i,a=this;s>e&&(i=+new Date,t.apply(a,arguments))}}function r(t,e){var i;return function(){function s(){t.apply(a,arguments),i=null}var a=this;clearTimeout(i),i=setTimeout(s,e)}}function o(t,e,i,s){if(null===t)return[];for(var a=[],n=[],r=0,o=t.length;o>r;r++){var l=t[r];i&&(l=i.call(s,l,r,t)),(e?r&&n===l:-1!==n.indexOf(l))||(e?n=l:n.push(l),a.push(t[r]))}return a}function l(t){return Array.prototype.slice.call(arguments,1).forEach(function(e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}),t}function h(t){var e,i,s,a,n=0,r=0,o=0,l=0,h=0,c=0,u=0,d=[],p=t.length;if(!p)return null;for(e=0;p>e;e++)d.push(e);for(e=0;p>e;e++)c=d[e],u=t[e],n+=c,r+=u,l+=c*c,o+=c*u,h++;return i=(h*o-n*r)/(h*l-n*n),s=r/h-i*n/h,a=Math.round(p*i+s),a>=0?a:0}function c(t){var e=[];return t.forEach(function(t){var i=l({},t),s=i.segments;delete i.segments,e.push(i),s&&s.length&&s.forEach(function(t){e.push(l({},t))})}),e}function u(t,e,i){var s,a,n,r=[],o=[];if(e.sequence){var h=e.sequence[i];a={},n=e.formatter||t.formatter||y.formatter,a.key=e.key,a.label=e.label,a.value=h,a.formatted_value=n(h),e.color&&(a.color=e.color),r.push(a)}return e.segments&&(s=d3.zip.apply(null,e.segments.map(function(t){return t.sequence})).map(function(t){return d3.sum(t)}),e.segments.forEach(function(t,r){if(-1!==e.topSegments.indexOf(t)&&!t.hide_tooltip){var h=t.sequence[i];a={},n=t.formatter||e.formatter||y.formatter,l(a,t),a.label=t.label,a.value=h,a.formatted_value=n(h),a.percentage=Math.round(h/s[i]*100)||0,a.color=t.color||e.colors(r).toString(),o.push(a)}}),o.length&&e.length?r[0].segments=o:r=r.concat(o)),r}function d(t,e,i){for(var s=t,a=e.split("."),n=a.pop(),r=a.shift();r;)s.hasOwnProperty(r)||(s[r]={}),s=s[r],r=a.shift();return s[n]=i,i}var p={version:"1.0.0"},f=function(e,i,s){for(var a=!0;a;){var n=e,r=i,o=s;l=c=h=t,a=!1,null===n&&(n=Function.prototype);var l=Object.getOwnPropertyDescriptor(n,r);if(l!==t){if("value"in l)return l.value;var h=l.get;return h===t?t:h.call(o)}var c=Object.getPrototypeOf(n);if(null===c)return t;e=c,i=r,s=o,a=!0}},g=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),y={},v=function(){function t(e,s,a){i(this,t),t.instances.push(this),this.options=a||{},this.id=t.lastUniqueId++,this.el=d3.select(e),this.data=s||[],this.autosize=!1,this.activeTips=[],t.installResizeListener()}return g(t,[{key:"draw",value:function(){}},{key:"drawWhenReady",value:function(){function t(){e.destroyed||(null!==i.offsetParent?e.draw():setTimeout(t,s))}var e=this,i=e.el[0][0],s=100;setTimeout(t,0)}},{key:"resize",value:function(){this.draw()}},{key:"update",value:function(t,e){this.data=t,this.draw(e)}},{key:"destroy",value:function(){var e=t.instances.indexOf(this);e>-1&&t.instances.splice(e,1),this.activeTip&&this.hideTooltip(this.activeTip),this.el.html(""),this.destroyed=!0}},{key:"showTooltip",value:function(t){return this.activeTips.push(t),y.showTooltip(t)}},{key:"hideTooltip",value:function(t){var e=y.hideTooltip(t),i=this.activeTips.indexOf(t);return i>-1&&this.activeTips.splice(i,1),e}}],[{key:"installResizeListener",value:function(){t.resizeListenerInstalled||(d3.select(window).on("resize.sonic",r(function(){t.instances.filter(function(t){return t.autosize}).forEach(function(t){return t.resize()})},50)),t.resizeListenerInstalled=!0)}}]),t}();v.lastUniqueId=0,v.instances=[],v.resizeListenerInstalled=!1;var m=function(){function t(e){i(this,t),this.data=e}return g(t,[{key:"draw",value:function(t){var e=this.data;t.svg.append("svg:rect").attr("x",t.x(e.x)).attr("y",t.y(e.y)).attr("width",t.x(e.w-1)-T.xPadding).attr("height",t.y(0)-t.y(e.h)).attr("stroke",e.color).attr("fill",e.color)}}]),t}(),x=function(){function t(e,s,a){i(this,t),this.key=e.key,this.label=e.label,this.color=e.color,this.sequence=e.sequence,this.segments=e.segments,this.invisible=!0,this.formatter=e.formatter||a.formatter}return g(t,[{key:"draw",value:function(){}}]),t}(),b=function(){function t(e,s,a){i(this,t);var n=this;this.key=e.key,this.label=e.label,this.color=e.color,this.sequence=e.sequence,this.segments=e.segments,this.lineSegments=this.segments||[e],this.colors=a.colors||y.colors,this.formatter=e.formatter||a.formatter,this.lineSegments.forEach(function(t){0===t.sequence[t.sequence.length-1]&&e.extrapolate_last&&(t.sequence.pop(),t.sequence.push(h(t.sequence))),t.label=t.label,t.dasharray=t.dasharray||e.dasharray,t.strokewidth=t.strokewidth||e.strokewidth||2,t.interpolate=t.interpolate||e.interpolate,n.interpolate&&t.sequence.map(function(e,i){0===e&&(t.sequence[i]=h(t.sequence.slice(0,i)))},t),t.cardinality=e.sequence.length,n.cardinality=d3.max([n.cardinality||0,t.cardinality])}),this.lineSegments&&(this.topSegments=this.lineSegments.slice(0).sort(function(t,e){return d3.descending(d3.sum(t.sequence),d3.sum(e.sequence))}).slice(0,10))}return g(t,[{key:"max",value:function(){return d3.max(this.lineSegments.map(function(t){return d3.max(t.sequence)}))}},{key:"draw",value:function(t){var e=this;this.lineSegments.forEach(function(i,s){if(-1!==e.topSegments.indexOf(i)){var a,n,r,o,l,h=i.sequence.map(function(t,e){return{x:e,y:t}});l=i.color||e.colors(s).toString(),i.fill&&(n=d3.svg.area().x(function(e){return t.x(e.x)}).y0(t.y(t.yRange[0])).y1(function(e){return t.y(e.y)}),o=t.svg.append("svg:path").attr("d",n(h)).attr("transform","translate(0,-1)"),"boolean"==typeof i.fill?o.attr("fill",l).attr("fill-opacity",.3):o.attr("fill",i.fill)),a=d3.svg.line().x(function(e){return t.x(e.x)}).y(function(e){return t.y(e.y)}),r=t.svg.append("svg:path").attr("d",a(h)).attr("transform","translate(0,-1)").attr("stroke",l).attr("stroke-width",i.strokewidth||e.strokewidth).attr("fill","transparent"),(i.dasharray||e.dasharray)&&r.attr("stroke-dasharray",i.dasharray||e.dasharray)}})}}]),t}(),w=function(){function t(e,s,a){if(i(this,t),this.key=e.key,this.label=e.label,this.color=e.color,this.sequence=e.sequence,this.cardinality=e.sequence.length,this.percent=e.percent,this.interpolate=e.interpolate,this.segments=e.segments,this.formatter=e.formatter||a.formatter,this.segments&&(this.topSegments=this.segments.slice(0).sort(function(t,e){return d3.descending(d3.sum(t.sequence),d3.sum(e.sequence))}).slice(0,10)),this.interpolate){var n=[],r=this.segments?d3.zip.apply(null,this.segments.map(function(t){return t.sequence})):d3.zip(this.sequence);r.forEach(function(t,e){0===d3.sum(t)&&n.push(e)},this),this.segements?this.segments.map(function(t,e){t.sequence.map(function(t,i){-1!==n.indexOf(i)&&(this.segments[e].sequence[i]=h(this.segments[e].sequence.slice(0,i)))},this)},this):this.sequence.map(function(t,e){-1!==n.indexOf(e)&&(this.sequence[e]=h(this.sequence.slice(0,e)))},this)}}return g(t,[{key:"max",value:function(){if(this.percent)return 100;var t=this.segments?d3.zip.apply(null,this.segments.map(function(t){return t.sequence})):d3.zip(this.sequence);return d3.max(t.map(function(t){return d3.sum(t)}))}},{key:"sequenceData",value:function(){var t=this.segments?this.segments.map(function(t,e){var i=t.color||y.colors(e).toString();return t.sequence.map(function(e,s){return{x:s,y:e,value:e,label:t.label,color:i}})}):[this.sequence.map(function(t,e){return{x:e,y:t,value:t,label:this.label,color:this.color||y.colors(e).toString()}},this)];return t=d3.layout.stack().offset(this.percent?"expand":"zero").order("reverse")(t),this.sequenceData=function(){return t},t}},{key:"draw",value:function(t){var e,i=this.sequenceData(),s=this;e=d3.svg.area().x(function(e){return t.x(e.x)}).y0(function(e){if(s.percent){var i=t.yAxis?t.y(0)-T.yPadding:t.y(0);return t.y(0)-i*e.y0}return t.y(e.y0)}).y1(function(e){if(s.percent){var i=t.yAxis?t.y(0)-T.yPadding:t.y(0);return t.y(0)-i*(e.y0+e.y)}return t.y(e.y0+e.y)}),i.forEach(function(i){t.svg.append("svg:path").attr("d",e(i)).attr("fill",i[0].color).attr("stroke-width",0).attr("stroke",i[0].color)})}}]),t}(),k=function(){function t(e,s,a){i(this,t),this.key=e.key,this.label=e.label,this.sequence=e.sequence,this.percent=e.percent,this.color=e.color||y.colors(s).toString(),this.cardinality=e.sequence.length,this.spacing=e.spacing||8,this.col_width=e.col_width,this.segments=e.segments,this.formatter=e.formatter||a.formatter,this.segments&&(this.topSegments=this.segments.slice(0).sort(function(t,e){return d3.descending(d3.sum(t.sequence),d3.sum(e.sequence))}).slice(0,10))}return g(t,[{key:"max",value:function(){return w.prototype.max.apply(this,arguments)}},{key:"sequenceData",value:function(){var t=this.segments?this.segments.map(function(t,e){var i=t.color||y.colors(e).toString();return t.sequence.map(function(e,s){return{x:s,y:e,value:e,label:t.label,color:i}}).sort(function(){})}):[this.sequence.map(function(t,e){return{x:e,y:t,value:t,label:this.label,color:this.color||y.colors(e).toString()}},this)];return t=d3.layout.stack().offset(this.percent?"expand":"zero")(t),this.sequenceData=function(){return t},t}},{key:"draw",value:function(t){var e,i,s,a,n,r,o=this.sequenceData(),l=this.sequence,h=this.percent;this.col_width?e=this.col_width:(e=t.getWidth(),e=Math.floor((e-this.spacing*o[0].length)/o[0].length));var c=t.getHeight()-2*T.yPadding;n=c,h||(r=1,this.sequence.forEach(function(t){t>r&&(r=t)}),n=c/r);var u=function(r){0!==l[r.x]&&(a=r.y0*n+T.yPadding,h||(a+=c-l[r.x]*n),i=r.y*n,s=t.x(r.x)-e/2,t.svg.append("svg:rect").attr("x",s).attr("y",a).attr("width",e).attr("height",i).attr("stroke-width",0).attr("fill",r.color))};o.forEach(function(t){t.forEach(u,this)})}}]),t}(),T=function(s){function l(t,e,s){i(this,l),f(Object.getPrototypeOf(l.prototype),"constructor",this).call(this,t,e,s),this.autosize=!0,this.loadOptions(),this.attachMouseEvents()}return e(l,s),g(l,[{key:"setOption",value:function(t,e,i){d(this.options,t,e),this.loadOptions(),this.draw(i)}},{key:"loadOptions",value:function(){var t=this.options;this.width=t.width||"auto",this.height=t.height||"auto",this.axis="axis"in t?t.axis:!0,this.dateAxis=t.dateAxis||"daily",this.dateAxisTicks=t.dateAxisTicks,this.yAxis=t.yAxis,this.xAxis=t.xAxis,this.colors=t.colors||y.colors,this.el.style("position","relative"),"none"!==this.dateAxis?(this.startTime=new Date(t.startTime),this.endTime=new Date(t.endTime)):this.xAxis?(this.startTime=1,this.endTime=this.xAxis.length,this.ticks={x:this.xAxis.length}):(this.startTime=t.startTime,this.endTime=t.endTime),this.dateAxisTicks&&(this.ticks={x:this.dateAxisTicks}),this.ticks=this.ticks||{x:l.timeScales[t.dateAxis].ticks},this.ruleTicks={x:t.ruleTicks||l.timeScales[t.dateAxis].ruleTicks},this.dateFormatter=l.timeScales[t.dateAxis].formatter,this.formatter=t.formatter||y.formatter,this.bands=(t.bands||[]).map(function(t){return new m(t)}),this.tickFormat=t.tickFormat||",",this.xTickPadding=t.xTickPadding||0,this.tooltip=t.tooltip||y.tooltip}},{key:"attachMouseEvents",value:function(){var t=this;this.tooltip&&(this.el.on("mousemove",n(function(){if(t.x){var e,i,s,n,r=this,o=a(r);e=Math.round(t.x.invert(d3.event.pageX-o.left));var l=t.timeScaleTicks&&t.timeScaleTicks.length-1;l&&(e=Math.min(Math.max(e,0),l)),i=t.x(e),s=t.tooltipData(e),s.segments&&(n=t.tooltip(t,s)),n&&(t.scrubber.style({position:"absolute",height:t.y.range()[0]-t.y.range()[1]+"px",visibility:"visible",left:i+"px",top:t.y.range()[1]+"px"}),t.showTooltip({body:n,target:t.scrubber.node(),chart:t.el.node()}))}},50)),this.el.on("mouseleave",r(function(){t.hideTooltip({target:t.scrubber.node()}),t.scrubber.style("visibility","hidden")},100)))}},{key:"getWidth",value:function(){var e=this.el[0][0].offsetWidth;return"auto"!==this.width?this.width:e===t?600:e}},{key:"getHeight",value:function(){var t=this.el[0][0].offsetHeight;return"auto"!==this.height?this.height:0===t?180:t}},{key:"draw",value:function(){var t,e,i,s,a,n,r,h,c=this,u=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("linear"),d=4.5,p=5;if(this.el.html("").classed("sonic-series-graph",!0).style("width","").style("height",""),t=this.getWidth(),e=this.getHeight(),this.el.style("width",t+"px").style("height",e+"px"),this.axis&&(this.dateAxis||this.xAxis)&&this.el.classed("x-axis",!0),this.dateAxis||this.xAxis?(i=[l.xPadding+this.xTickPadding,t-l.xPadding-this.xTickPadding],a=[l.xPadding,t-l.xPadding]):(i=[this.xTickPadding,t-this.xTickPadding],a=[0,t]),this.yAxis?(this.el.classed("y-axis",!0),s=[e-l.yPadding,l.yPadding]):s=[e,0],n="none"!==this.dateAxis?d3.time.scale:d3.scale.linear,this.svg=this.el.append("svg:svg").attr("width",t).attr("height",e),this.x=d3.scale.linear().domain([0,this.elements[0].cardinality-1]).rangeRound(i),this.x_axis=d3.scale.linear().domain([0,this.elements[0].cardinality-1]).rangeRound(a),this.y=d3.scale.linear().domain(this.yRange).rangeRound(s),this.timeScale=n().domain([this.startTime,this.endTime]).range(i),this.timeScaleTicks=o(this.timeScale.ticks(this.ticks.x).concat([this.endTime]),!0,function(t){return t.valueOf()}),this.axis&&(this.dateAxis||this.xAxis)){var f=this.svg.append("svg:g");r={x:this.x_axis(0),y:this.y(this.yRange[0])+d},h={x:this.x_axis.range()[1]+d,y:r.y},f.append("svg:path").attr("d",u([r,h])).attr({"stroke-width":1,stroke:"#aaaaaa"}),this.timeScaleTicks.forEach(function(t,e){this.xAxis&&(t=this.xAxis[e]);var i;if(i="daily"===this.dateAxis&&t.getDay?1===t.getDay():e%this.ruleTicks.x===0){var s=Math.round(this.x(e))+.5,a={x:s,y:this.y(this.yRange[0])+p+d},n={x:s,y:this.y(this.yRange[0])+d};f.append("svg:path").attr("d",u([a,n])).attr("stroke-width",1).attr("stroke","#aaaaaa"),f.append("svg:text").text(this.dateFormatter(t)).attr("x",s).attr("y",a.y+6).attr("font-size",9).attr("text-anchor","middle").attr("fill","#333")}},this)}if(this.axis&&this.yAxis){var g,y=this.yAxis instanceof Array,v=d3.scale.linear().domain([0,this.y.domain()[1]-this.y.domain()[0]]).range(this.y.range()),m=this.svg.append("svg:g");if(y)g=this.yAxis,r={x:this.x_axis.range()[1]+d,y:v(0)+d},h={x:r.x,y:v.range()[1]},m.append("svg:path").attr("d",u([r,h]));else{var x=this.y.domain();g=d3.max(x)-d3.min(x)<2&&"%"!==this.tickFormat?x:[this.y.domain()[0],Math.round(this.y.domain()[1]/2*100)/100,this.y.domain()[1]],r={x:this.x_axis.range()[1]+d,y:this.y(0)+d},h={x:r.x,y:this.y.range()[1]}}m.append("svg:path").attr("d",u([r,h])).attr("stroke-width",1).attr("stroke","#aaaaaa");var b=Math.floor((this.y.domain()[1]-this.y.domain()[0])/(g.length-1));g.forEach(function(t,e){if(null!==t){var i,s,a,n=d3.format(this.tickFormat);i=y?Math.round(v(e*b))+.5:Math.round(this.y(t))+.5,r={x:this.x_axis.range()[1]+d,y:i},h={x:r.x+p,y:r.y},s=m.append("svg:path").attr("d",u([r,h])).attr("stroke-width",1).attr("stroke","#aaaaaa"),a="string"==typeof t?d3.requote(t):n(t),m.append("svg:text").text(a).attr("x",h.x+2).attr("y",i).attr("font-size",9).attr("text-anchor","right").attr("alignment-baseline","middle").attr("fill","#333")}},this)}return this.bands.forEach(function(t){t.draw(this)},this),this.elements.forEach(function(t){t.draw(this)},this),this.scrubber=this.el.append("div").classed("sonic-scrubber",!0),c}},{key:"tooltipData",value:function(t){var e,i=this,s={},a=[];try{e=this.timeScaleTicks[t]}catch(n){}return e&&(s.date=e,s.formatted_date=this.dateFormatter(s.date)),this.elements.forEach(function(e){a=a.concat(u(i,e,t))}),s.segments=a,s}},{key:"data",get:function(){return this._data},set:function(t){var e,i=this,s=this.options;return this._data=t,this.elements=t.map(function(t,e){return new l.elementTypes[t.type](t,e,i)}),e=d3.max(this.elements.map(function(t){return t.invisible?0:t.max()}))||1,this.yRange=s.yRange||[s.yBase||0,e],t}}]),l}(v);T.xPadding=40,T.yPadding=20,T.timeScales={hourly:{ticks:24,formatter:d3.time.format("%I%p"),ruleTicks:3},daily:{ticks:30,formatter:d3.time.format("%b %e"),ruleTicks:7},weekly:{ticks:8,formatter:d3.time.format("%x"),ruleTicks:1},monthly:{ticks:6,formatter:d3.time.format("%m/%y"),ruleTicks:1},none:{ticks:0,formatter:function(t){return t},ruleTicks:0}},T.elementTypes={invisible:x,line:b,area:w,column:k};var _=function(t){function s(t,e,a){i(this,s),f(Object.getPrototypeOf(s.prototype),"constructor",this).call(this,t,e,a);var n=this.options;this.width=n.width||120,this.height=n.height||40,this.yGuides=n.y_guides||[],n.y_guide&&this.yGuides.push(n.y_guide),this.strokeColor=n.stroke_color||n.color||"blue",this.strokeWidth=n.stroke_width||1}return e(s,t),g(s,[{key:"draw",value:function(){var t={left:0,top:2,right:0,bottom:2},e=this.width,i=this.height,s=this.yGuides,a=this.data,n=this.strokeColor,r=this.strokeWidth,o=d3.max(a),l=d3.min([0].concat(a)),h=a.length,c=d3.scale.linear().domain([0,h-1]).range([t.left,e-t.left-t.right]),u=d3.scale.linear().domain([l,o]).range([i-t.top-t.bottom,t.top]),d=d3.svg.line().x(function(t,e){return c(e)}).y(function(t){return u(t)}),p=this.el.classed("sonic-sparkline-graph",!0).html(""),f=p.append("svg").attr("width",e).attr("height",i);f.append("clipPath").attr("id","clip").append("rect").attr("x",0).attr("y",0).attr("width",e).attr("height",i),f.selectAll(".sonic-sparkline-graph-y-guide").data(s).enter().append("line").classed("sonic-sparkline-graph-y-guide",!0).attr("clip-path","url(#clip)").attr("x1",c(0)).attr("y1",function(t){return Math.floor(u(t))+.5}).attr("x2",c(h-1)).attr("y2",function(t){return Math.floor(u(t))+.5}).attr("fill","none").attr("stroke","#ddd").attr("stroke-width",1).attr("stroke-linecap","butt"),f.append("path").classed("sonic-sparkline-graph-stroke",!0).attr("clip-path","url(#clip)").attr("d",d(a)).attr("fill","none").attr("stroke",n).attr("stroke-width",r).attr("stroke-linecap","butt")}}]),s}(v),q=function(t){function s(t,e,a){i(this,s),f(Object.getPrototypeOf(s.prototype),"constructor",this).call(this,t,e,a);var n=this.options;this.size=n.size||50}return e(s,t),g(s,[{key:"sequenceData",value:function(){var t=d3.layout.pie().value(function(t){return t.value})(this.data);return this.sequenceData=function(){return t},t}},{key:"draw",value:function(){var t=this.size,e=t/2-1,i=d3.svg.arc().outerRadius(e),s=this.sequenceData(),a=this.el.classed("sonic-pie-graph",!0).style({position:"relative",width:this.size+"px",height:0,"padding-bottom":this.size+"px"}).html(""),n=a.append("svg:svg").attr("width",this.size).attr("height",this.size).attr("viewBox",[0,0,t,t].join(" ")).style({position:"absolute",left:0,top:0});s.forEach(function(t,s){if(0!==t.value){var a=this.data[s].color||y.colors(s).toString();n.append("svg:path").attr("d",i(t)).attr("transform","translate("+(e+1)+","+(e+1)+")").attr("fill",a).attr("stroke",a)}},this)}}]),s}(v),z=function(t){function a(t,e,n){i(this,a),f(Object.getPrototypeOf(a.prototype),"constructor",this).call(this,t,e,n);var r=n;this.size=r.size||parseInt(this.el.style("width"),10),this.radius=this.size/2,this.thickness=r.thickness||Math.round(this.radius/7),this.value=r.value,this.value_text="undefined"==typeof r.value_text?s(this.value):r.value_text,this.value_color=r.value_color,this.label=r.label,this.label_position=r.label_position||"center",this.label_color=r.label_color,this.label_subtext=r.label_subtext,this.color=r.color||"gray",this.total=r.total,this.data.length||(this.data=[{value:this.value,color:this.color}]),this.type=r.type||"small"}return e(a,t),g(a,[{key:"draw",value:function(){for(var t,e,i=d3.layout.pie().sort(null).startAngle(0).value(function(t){return t.value}),s=this.data,a=this.total,n=this.radius-this.thickness,r=this.radius,o=function(){return d3.svg.arc().innerRadius(n).outerRadius(r)},l=0,h=0;h<s.length;h++)l+=s[h].value;this.total?i.endAngle(2*Math.PI*l/a):a=l,this.el.classed("sonic-donut-graph",!0).style("width",this.size+"px").style("height",this.size+"px").html(""),this.type&&this.el.classed(this.type,!0);var c=this.el.append("div").style("position","relative").style("width",this.size+"px").style("height",this.size+"px"),u=c.append("svg:svg").attr("width",this.size).attr("height",this.size);if(u.append("svg:path").classed("sonic-donut-graph-background",!0).attr("fill","#e5e5e5").attr("transform","translate("+this.radius+","+this.radius+")").attr("d",o().startAngle(0).endAngle(2*Math.PI)()),u.append("svg:g").selectAll(".sonic-donut-graph-arc").data(i(this.data)).enter().append("svg:path").classed("sonic-donut-graph-arc",!0).attr("transform","translate("+this.radius+","+this.radius+")").attr("fill",function(t){return t.data.color}).attr("d",o()),this.label&&"center"===this.label_position){var d=c.append("div").style("position","absolute").style("display","table").style("top",this.thickness+"px").style("left",this.thickness+"px").style("width",this.size-2*this.thickness+"px").style("height",this.size-2*this.thickness+"px"),p=d.append("div").style("display","table-cell").style("text-align","center").style("vertical-align","middle");t=p.append("div").classed("sonic-donut-graph-value",!0).text(this.value_text),e=p.append("div").classed("sonic-donut-graph-label",!0).style("text-align","center").text(this.label)}else{t=c.append("div").classed("sonic-donut-graph-value",!0).style("white-space","nowrap").style("overflow","visible").style("display","inline-block").text(this.value_text);var f={width:parseInt(t.style("width"),10),height:parseInt(t.style("height"),10)};if(t.style("position","absolute").style("left",(this.size-f.width)/2+"px").style("top",(this.size-f.height)/2+"px"),this.label){var g=this.size;e=c.append("div").classed("sonic-donut-graph-label",!0).style("white-space","nowrap").style("overflow","visible").style("display","inline-block").text(this.label),this.label_subtext&&(e.node().appendChild(document.createTextNode(" ")),e.append("span").classed("sonic-donut-graph-label-subtext",!0).text(this.label_subtext));var y={width:parseInt(e.style("width"),10),height:parseInt(e.style("height"),10)},v=y.height/2;e.style("position","absolute").style("left",this.size+v+"px").style("top",(this.size-y.height)/2+"px"),g+=v+y.width,u.attr("width",g+"px"),this.el.style("width",g+"px")}t&&this.value_color&&t.style("color",this.value_color),e&&this.label_color&&e.style("color",this.label_color)}}}]),a}(v),A=function(t){function a(t,e,s){i(this,a),f(Object.getPrototypeOf(a.prototype),"constructor",this).call(this,t,e,s);var n=this.options;this.size=n.size||44,this.thickness=n.thickness,this.total=n.total,this.label_subtext=n.label_subtext||""}return e(a,t),g(a,[{key:"draw",value:function(){var t,e=this.data,i=this.total;if(!i)for(i=0,t=0;t<e.length;t++)i+=e[t].value;for(this.el.classed("sonic-donut-stack-graph",!0).html(""),t=0;t<e.length;t++){var a=this.el.append("div").classed("sonic-donut-stack-graph-item",!0),n=s(e[t].value);this.label_subtext&&(n+=" "+this.label_subtext);var r=new z(a.node(),[],{total:i,value:e[t].value,value_text:s(Math.round(100*e[t].value/i))+"%",value_color:e[t].color,label:e[t].label,label_position:"right",label_subtext:n,color:e[t].color,size:this.size,thickness:this.thickness});r.el.classed("sonic-donut-stack-graph-item-donut-graph"),r.draw()}}}]),a}(v),P=function(t){function s(t,e,a){i(this,s),f(Object.getPrototypeOf(s.prototype),"constructor",this).call(this,t,e,a);var n=this.options;this.percentages=n.percentages}return e(s,t),g(s,[{key:"draw",value:function(){var t=d3.sum(this.data,function(t){return t.value}),e=d3.scale.linear().domain([0,d3.max(this.data,function(t){return t.value})]).range([0,100]),i=d3.scale.linear().domain([0,t]).range([0,100]);this.el.classed("sonic-horizontal-bar-graph",!0);var s=this.el.selectAll(".sonic-horizontal-bar-graph-segment").data(this.data).enter().append("div").classed("sonic-horizontal-bar-graph-segment",!0),a=s.append("div").classed("sonic-horizontal-bar-graph-label",!0);a.text(this.percentages?function(e){var s=Math.round(i(e.value||0));return 0===t&&(s="--"),s+"% "+e.label}:function(t){return t.label}),a.append("span").classed("sonic-horizontal-bar-graph-label-subtext",!0).text(function(t){return t.label_subtext}),s.append("div").classed("sonic-horizontal-bar-graph-value",!0).append("div").classed("sonic-horizontal-bar-graph-value-bar",!0).style("background-color",function(t){return t.color}).style("width",function(t){return e(t.value||0)+"%"}).style("min-width","1px")}}]),s}(v),S=function(t){function s(t,e,a){i(this,s),f(Object.getPrototypeOf(s.prototype),"constructor",this).call(this,t,e,a),this.autosize=!0;var n=this.options;this.svg=this.el.append("svg"),this.labels=!!e[0].label,this.label_subtext=!!e[0].label_subtext,this.colors=n.colors||y.colors,this.tooltip=n.tooltip||y.tooltip,this.formatter=n.formatter||y.formatter}return e(s,t),g(s,[{key:"draw",value:function(){var t,e,i=this,s=i.svg,a=35,n={label:18,label_subtext:16,bar:a+8},r=d3.sum(this.data,function(t){return t.value}),o=0===r,l=function(t){return d3.format("%")(t)};this.el.classed("sonic-pipeline-graph",!0),s.attr("width",0),t=i.width=parseInt(this.el.style("width"),10),e=i.height=n.label+n.label_subtext+n.bar,s.attr("width",t).attr("height",e),o&&s.attr("opacity","0.25"),this.svg.html("");var h=0,c=this.data.length-1;this.data.forEach(function(t,e,s){t.x=h,t.percentage=o?1/s.length:t.value/r,t.width=e===c?i.width-h:Math.floor(t.percentage*i.width),t.color=t.color||i.colors(e),h+=t.width});var u=s.append("defs").selectAll("clipPath").data(this.data);u.enter().append("clipPath").attr("id",function(t,e){return"clip-"+i.id+"-"+e}).append("rect").attr("width",function(t){return t.width}).attr("height",e),u.exit().remove();var d=s.selectAll(".sonic-pipeline-graph-item").data(this.data);d.exit().remove();var p=d.enter().append("g").attr("class","sonic-pipeline-graph-item").attr("transform",function(t){return"translate("+t.x+",0)"}).attr("clip-path",function(t,e){return"url(#clip-"+i.id+"-"+e+")"});this.labels?p.append("text").attr("class","sonic-pipeline-graph-item-label").attr("x",2).attr("y",n.label).text(function(t){var e=l(t.percentage);return o&&(e="--%"),e+" "+t.label}):n.label=0,this.label_subtext?p.append("text").attr("class","sonic-pipeline-graph-item-label-subtext").attr("x",2).attr("y",n.label+n.label_subtext).text(function(t){return t.label_subtext}):n.label_subtext=0,this.height=e=n.label+n.label_subtext+n.bar,s.attr("height",e),p.append("rect").attr("class","sonic-pipeline-graph-item-bar").attr("fill",function(t){return t.color}).attr("y",n.label+n.label_subtext+n.bar-a).attr("width",function(t){return t.width}).attr("height",a),this.attachMouseEvents()}},{key:"attachMouseEvents",value:function(){var t=this,e=t.svg,i=-1;this.el.on("mousemove",n(function(){var s=d3.mouse(e.node())[0],a=e.selectAll(".sonic-pipeline-graph-item");a.each(function(e,n){var r=d3.select(this),o=r.select("rect"),l=parseInt((/\d+/.exec(r.attr("transform"))||["0"])[0],10),h=parseInt(o.attr("width"),10);if(n!==i&&s>=l&&l+h>s){if(i>-1){var c=a.filter(function(t,e){return e===i});t.mouseleave(c,c.datum(),i)}t.mouseenter(r,e,n),i=n}})},40)),this.el.on("mouseleave",function(){if(i>-1){var s=e.selectAll(".sonic-pipeline-graph-item"),a=s.filter(function(t,e){return e===i});t.mouseleave(a,a.datum(),i),i=-1}}),this.attachMouseEvents=function(){}}},{key:"mouseenter",value:function(t,e,i){var s,a=this,n=this.svg,r=e.color,o=10,l=0;if(t.select("rect").attr("fill",d3.lab(r).brighter(.3).toString()),this.labels&&this.label_subtext?l=Math.max(t.select(".sonic-pipeline-graph-item-label").node().getComputedTextLength(),t.select(".sonic-pipeline-graph-item-label-subtext").node().getComputedTextLength())+o:(this.labels&&(l=t.select(".sonic-pipeline-graph-item-label").node().getComputedTextLength()+o),this.label_subtext&&(l=t.select(".sonic-pipeline-graph-item-label-subtext").node().getComputedTextLength()+o)),l=Math.ceil(l),e.width<l){var h=e.width,c=l-h,u=n.selectAll(".sonic-pipeline-graph-item"),d=0,p=u[0].length-1;u.each(function(t,e){var s=d3.select(this),r=s.select("rect"),o=n.select("#clip-"+a.id+"-"+e).select("rect"),h=e===i?l:Math.floor(t.percentage*(a.width-c));e===p&&(h=a.width-d),s.transition().duration(200).attr("transform","translate("+d+",0)"),r.transition().duration(200).attr("width",h),o.transition().duration(200).attr("width",h),d+=h})}e.formatted_value||(e.formatted_value=this.formatter(e.value)),s=a.tooltip(a,{segments:[e]}),s&&a.showTooltip({body:s,position:"bottom",target:t.select("rect").node(),chart:a.el.node()})}},{key:"mouseleave",value:function(t,e,i){var s=this,a=this.svg,n=parseInt(a.select("#clip-"+s.id+"-"+i).select("rect").attr("width"),10),r=e.color;if(e.width<n){var o=a.selectAll(".sonic-pipeline-graph-item");o.each(function(t,e){var i=d3.select(this),n=i.select("rect"),r=a.select("#clip-"+s.id+"-"+e).select("rect");i.transition().duration(200).attr("transform","translate("+t.x+",0)"),n.transition().duration(200).attr("width",t.width),r.transition().duration(200).attr("width",t.width)})}t.select("rect").attr("fill",r),s.hideTooltip({target:t.select("rect").node()})}}]),s}(v),O=function(t){function a(){i(this,a),f(Object.getPrototypeOf(a.prototype),"constructor",this).apply(this,arguments)}return e(a,t),g(a,[{key:"draw",value:function(t){var e=function(t){return t.color},i=function(t){return t.label},a=function(t){return t.formatted_value||s(t.value)};this.el.classed("sonic-legend",!0);var n=this.el.selectAll(".sonic-legend-item").data(this.data);n.select(".sonic-legend-item-swatch").style("background-color",e),n.select(".sonic-legend-item-label").text(i),n.select(".sonic-legend-item-value").text(a);var r=n.enter().append("div").classed("sonic-legend-item",!0);r.filter(function(t){return!!t.color}).append("span").classed("sonic-swatch sonic-legend-item-swatch",!0).style("background-color",e),r.append("span").classed("sonic-legend-item-label",!0).text(i),r.append("span").classed("sonic-legend-item-value",!0).text(a);var o=n.exit();t?(r.style("opacity",0).transition().duration(1e3).style("opacity",1),o.transition().style("opacity",0).remove()):o.remove()}}]),a}(v);y.colors=d3.scale.category10();var E=d3.format(",");y.formatter=function(t){return t||0===t?E(t):"--"},y.showTooltip=function(){},y.hideTooltip=function(){},y.tooltip=function(t,e){var i,s,a,n,r=d3.select(document.createElement("div")),o=c(e.segments);if(1===o.length){var l=o[0];i=r.append("div").classed("sonic-tip-placard",!0),i.append("div").classed("sonic-tip-placard-value",!0).text(l.formatted_value||l.value),i.append("div").classed("sonic-tip-placard-label",!0).text(l.tip_label||l.label)}else s=r.append("div"),a=new O(s.node(),o),a.draw();return e.date&&(n=r.append("div").classed("sonic-tip-date",!0).text(t.dateFormatter(e.date))),r.node()},p.configure=function(t){var e={};t(e),y.colors=e.colors||y.colors,y.showTooltip=e.showTooltip||y.showTooltip,y.hideTooltip=e.hideTooltip||y.hideTooltip,y.tooltip=e.tooltip||y.tooltip,y.formatter=e.formatter||y.formatter},p.Legend=function(t,e,i){var s=new O(t,e,i);return s.drawWhenReady(),s},p.Series=function(t,e,i){var s=new T(t,e,i);return s.drawWhenReady(),s},p.Sparkline=function(t,e,i){var s=new _(t,e,i);return s.drawWhenReady(),s},p.Pie=function(t,e,i){var s=new q(t,e,i);return s.drawWhenReady(),s},p.Donut=function(t,e,i){var s=new z(t,e,i);return s.drawWhenReady(),s},p.DonutStack=function(t,e,i){var s=new A(t,e,i);return s.drawWhenReady(),s},p.HorizontalBar=function(t,e,i){var s=new P(t,e,i);return s.drawWhenReady(),s},p.Pipeline=function(t,e,i){var s=new S(t,e,i);return s.drawWhenReady(),s},"function"==typeof define&&define.amd?define(p):"object"==typeof module&&module.exports?module.exports=p:window&&(window.Sonic=p);

}();