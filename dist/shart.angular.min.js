!function(t,e){angular.module("shart",[]).directive("shartLegend",function(){return{restrict:"E",scope:{data:"="},link:function(t,e){Shart.Legend(e[0],t.data,{})}}}).directive("shartSeries",function(){return{restrict:"E",scope:{data:"=",startTime:"@",endTime:"@",dateAxis:"@",yAxisTicks:"="},link:function(t,e){Shart.Series(e[0],t.data,{startTime:t.startTime,endTime:t.endTime,dateAxis:t.dateAxis||"none",yAxis:{ticks:t.yAxisTicks}})}}}).directive("shartSparkline",function(){return{restrict:"E",scope:{data:"=",width:"=",height:"=",color:"@",strokeColor:"@",strokeWidth:"=",yGuide:"=",yGuides:"="},link:function(t,e){Shart.Sparkline(e[0],t.data,{width:t.width,height:t.height,color:t.color,stroke_color:t.strokeColor,stroke_width:t.strokeWidth,y_guide:t.yGuide,y_guides:t.yGuides})}}}).directive("shartPie",function(){return{restrict:"E",scope:{data:"=",size:"="},link:function(t,e){Shart.Pie(e[0],t.data,{size:t.size})}}}).directive("shartDonut",function(){return{restrict:"E",scope:{data:"=",label:"@",labelPosition:"@",value:"=",size:"=",type:"@"},link:function(t,e){Shart.Donut(e[0],t.data,{type:t.type||!1,label:t.label,label_position:t.labelPosition,value:t.value,size:t.size})}}}).directive("shartDonutStack",function(){return{restrict:"E",scope:{data:"=",total:"=",labelSubtext:"@",thickness:"="},link:function(t,e){Shart.DonutStack(e[0],t.data,{total:t.total,label_subtext:t.labelSubtext,thickness:t.thickness})}}}).directive("shartHorizontalBar",function(){return{restrict:"E",scope:{data:"=",percentages:"="},link:function(t,e){Shart.HorizontalBar(e[0],t.data,{percentages:t.percentages})}}}).directive("shartPipeline",function(){return{restrict:"E",scope:{data:"="},link:function(t,e){Shart.Pipeline(e[0],t.data,{})}}})}(window),function(t,e,i){function s(t){var e=parseInt("0"+t,10);return String(e).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function a(t){var e=t,i=0,s=0;if(e.offsetParent)do i+=e.offsetLeft,s+=e.offsetTop,e=e.offsetParent;while(e);return{left:i,top:s}}function r(t,e){var i=0;return function(){var s=+new Date-i,a=this;s>e&&(i=+new Date,t.apply(a,arguments))}}function n(t,e){var i;return function(){function s(){t.apply(a,arguments),i=null}var a=this;clearTimeout(i),i=setTimeout(s,e)}}function l(t,e,i,s){if(null===t)return[];for(var a=[],r=[],n=0,l=t.length;l>n;n++){var o=t[n];i&&(o=i.call(s,o,n,t)),(e?n&&r===o:-1!==r.indexOf(o))||(e?r=o:r.push(o),a.push(t[n]))}return a}function o(t){return Array.prototype.slice.call(arguments,1).forEach(function(e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}),t}function h(t){var e,i,s,a,r=0,n=0,l=0,o=0,h=0,c=0,u=0,d=[],p=t.length;if(!p)return null;for(e=0;p>e;e++)d.push(e);for(e=0;p>e;e++)c=d[e],u=t[e],r+=c,n+=u,o+=c*c,l+=c*u,h++;return i=(h*l-r*n)/(h*o-r*r),s=n/h-i*r/h,a=Math.round(p*i+s),a>=0?a:0}var c;c=function(){function i(){return S++}function c(t){var e=[];return t.forEach(function(t){var i=o({},t),s=i.segments;delete i.segments,e.push(i),s&&s.length&&s.forEach(function(t){e.push(o({},t))})}),e}function u(e,i){var s,a,r,n=[],l=[];if(e.sequence){var h=e.sequence[i];a={},r=e.formatter||E.formatter,a.key=e.key,a.label=e.label,a.value=h,a.formatted_value=r(h),e.color&&(a.color=e.color),n.push(a)}return e.segments&&(s=t.zip.apply(null,e.segments.map(function(t){return t.sequence})).map(function(e){return t.sum(e)}),e.segments.forEach(function(t,n){if(-1!==e.topSegments.indexOf(t)&&!t.hide_tooltip){var h=t.sequence[i];a={},r=t.formatter||e.formatter||E.formatter,o(a,t),a.label=t.label,a.value=h,a.formatted_value=r(h),a.percentage=Math.round(h/s[i]*100)||0,a.color=t.color||e.colors(n).toString(),l.push(a)}}),l.length&&n.length?n[0].segments=l:n=n.concat(l)),n}function d(i){t.select(e).on("resize.shart"+F++,n(function(){i.draw()},50))}var p,f,g,m,v,y,x,b,w,k,_,T,q,A,z,S,E={},M=40,D=20,P=t.time.format("%b %e"),I=t.time.format("%I%p"),R=t.time.format("%x"),C=t.time.format("%m/%y");z={hourly:{ticks:24,formatter:I,ruleTicks:3},daily:{ticks:30,formatter:P,ruleTicks:7},weekly:{ticks:8,formatter:R,ruleTicks:1},monthly:{ticks:6,formatter:C,ruleTicks:1},none:{ticks:0,formatter:function(t){return t},ruleTicks:0}},S=0,A=function(t){this.data=t},A.prototype.draw=function(t){var e=this.data;t.svg.append("svg:rect").attr("x",t.x(e.x)).attr("y",t.y(e.y)).attr("width",t.x(e.w-1)-M).attr("height",t.y(0)-t.y(e.h)).attr("stroke",e.color).attr("fill",e.color)},k=function(t,e,i){this.key=t.key,this.label=t.label,this.color=t.color,this.sequence=t.sequence,this.segments=t.segments,this.invisible=!0,this.formatter=t.formatter||i.formatter},k.prototype={draw:function(){}},_=function(e,i,s){var a=this;this.key=e.key,this.label=e.label,this.color=e.color,this.sequence=e.sequence,this.segments=e.segments,this.lineSegments=this.segments||[e],this.colors=s.colors||E.colors,this.formatter=e.formatter||s.formatter,this.lineSegments.forEach(function(i){0===i.sequence[i.sequence.length-1]&&e.extrapolate_last&&(i.sequence.pop(),i.sequence.push(h(i.sequence))),i.label=i.label,i.dasharray=i.dasharray||e.dasharray,i.strokewidth=i.strokewidth||e.strokewidth||2,i.interpolate=i.interpolate||e.interpolate,a.interpolate&&i.sequence.map(function(t,e){0===t&&(i.sequence[e]=h(i.sequence.slice(0,e)))},i),i.cardinality=e.sequence.length,a.cardinality=t.max([a.cardinality||0,i.cardinality])}),this.lineSegments&&(this.topSegments=this.lineSegments.slice(0).sort(function(e,i){return t.descending(t.sum(e.sequence),t.sum(i.sequence))}).slice(0,10))},_.prototype={max:function(){return t.max(this.lineSegments.map(function(e){return t.max(e.sequence)}))},draw:function(e){var i=this;this.lineSegments.forEach(function(s,a){if(-1!==i.topSegments.indexOf(s)){var r,n,l,o,h,c=s.sequence.map(function(t,e){return{x:e,y:t}});h=s.color||i.colors(a).toString(),s.fill&&(n=t.svg.area().x(function(t){return e.x(t.x)}).y0(e.y(e.yRange[0])).y1(function(t){return e.y(t.y)}),o=e.svg.append("svg:path").attr("d",n(c)).attr("transform","translate(0,-1)"),"boolean"==typeof s.fill?o.attr("fill",h).attr("fill-opacity",.3):o.attr("fill",s.fill)),r=t.svg.line().x(function(t){return e.x(t.x)}).y(function(t){return e.y(t.y)}),l=e.svg.append("svg:path").attr("d",r(c)).attr("transform","translate(0,-1)").attr("stroke",h).attr("stroke-width",s.strokewidth||i.strokewidth).attr("fill","transparent"),(s.dasharray||i.dasharray)&&l.attr("stroke-dasharray",s.dasharray||i.dasharray)}})}},q=function(e,i,s){if(this.key=e.key,this.label=e.label,this.color=e.color,this.sequence=e.sequence,this.cardinality=e.sequence.length,this.percent=e.percent,this.interpolate=e.interpolate,this.segments=e.segments,this.formatter=e.formatter||s.formatter,this.segments&&(this.topSegments=this.segments.slice(0).sort(function(e,i){return t.descending(t.sum(e.sequence),t.sum(i.sequence))}).slice(0,10)),this.interpolate){var a=[],r=this.segments?t.zip.apply(null,this.segments.map(function(t){return t.sequence})):t.zip(this.sequence);r.forEach(function(e,i){0===t.sum(e)&&a.push(i)},this),this.segements?this.segments.map(function(t,e){t.sequence.map(function(t,i){-1!==a.indexOf(i)&&(this.segments[e].sequence[i]=h(this.segments[e].sequence.slice(0,i)))},this)},this):this.sequence.map(function(t,e){-1!==a.indexOf(e)&&(this.sequence[e]=h(this.sequence.slice(0,e)))},this)}},q.prototype={max:function(){if(this.percent)return 100;var e=this.segments?t.zip.apply(null,this.segments.map(function(t){return t.sequence})):t.zip(this.sequence);return t.max(e.map(function(e){return t.sum(e)}))},sequenceData:function(){var e=this.segments?this.segments.map(function(t,e){var i=t.color||E.colors(e).toString();return t.sequence.map(function(e,s){return{x:s,y:e,value:e,label:t.label,color:i}})}):[this.sequence.map(function(t,e){return{x:e,y:t,value:t,label:this.label,color:this.color||E.colors(e).toString()}},this)];return e=t.layout.stack().offset(this.percent?"expand":"zero").order("reverse")(e),this.sequenceData=function(){return e},e},draw:function(e){var i,s=this.sequenceData(),a=this;i=t.svg.area().x(function(t){return e.x(t.x)}).y0(function(t){if(a.percent){var i=e.yAxis?e.y(0)-D:e.y(0);return e.y(0)-i*t.y0}return e.y(t.y0)}).y1(function(t){if(a.percent){var i=e.yAxis?e.y(0)-D:e.y(0);return e.y(0)-i*(t.y0+t.y)}return e.y(t.y0+t.y)}),s.forEach(function(t){e.svg.append("svg:path").attr("d",i(t)).attr("fill",t[0].color).attr("stroke-width",0).attr("stroke",t[0].color)})}},T=function(e,i,s){this.key=e.key,this.label=e.label,this.sequence=e.sequence,this.percent=e.percent,this.color=e.color||E.colors(i).toString(),this.cardinality=e.sequence.length,this.spacing=e.spacing||8,this.col_width=e.col_width,this.segments=e.segments,this.formatter=e.formatter||s.formatter,this.segments&&(this.topSegments=this.segments.slice(0).sort(function(e,i){return t.descending(t.sum(e.sequence),t.sum(i.sequence))}).slice(0,10))},T.prototype={sequenceData:function(){var e=this.segments?this.segments.map(function(t,e){var i=t.color||E.colors(e).toString();return t.sequence.map(function(e,s){return{x:s,y:e,value:e,label:t.label,color:i}}).sort(function(){})}):[this.sequence.map(function(t,e){return{x:e,y:t,value:t,label:this.label,color:this.color||E.colors(e).toString()}},this)];return e=t.layout.stack().offset(this.percent?"expand":"zero")(e),this.sequenceData=function(){return e},e},max:q.prototype.max,draw:function(t){var e,i,s,a,r,n,l=this.sequenceData(),o=this.sequence,h=this.percent;this.col_width?e=this.col_width:(e=t.width,e=Math.floor((e-this.spacing*l[0].length)/l[0].length));var c=t.height-2*D;r=c,h||(n=1,this.sequence.forEach(function(t){t>n&&(n=t)}),r=c/n);var u=function(n){0!==o[n.x]&&(a=n.y0*r+D,h||(a+=c-o[n.x]*r),i=n.y*r,s=t.x(n.x)-e/2,t.svg.append("svg:rect").attr("x",s).attr("y",a).attr("width",e).attr("height",i).attr("stroke-width",0).attr("fill",n.color))};l.forEach(function(t){t.forEach(u,this)})}},w={invisible:k,line:_,area:q,column:T},p=function(e,s,l){var o,h=this;l=l||{},this.id=i(),this.dateAxis=l.dateAxis||"daily",this.dateAxisTicks=l.dateAxisTicks,this.yAxis=l.yAxis,this.xAxis=l.xAxis,this.colors=l.colors||E.colors,this.el=t.select(e).style("position","relative"),"none"!==this.dateAxis?(this.startTime=new Date(l.startTime),this.endTime=new Date(l.endTime)):this.xAxis?(this.startTime=1,this.endTime=this.xAxis.length,this.ticks={x:this.xAxis.length}):(this.startTime=l.startTime,this.endTime=l.endTime),this.dateAxisTicks&&(this.ticks={x:this.dateAxisTicks}),this.ticks=this.ticks||{x:z[l.dateAxis].ticks},this.ruleTicks={x:l.ruleTicks||z[l.dateAxis].ruleTicks},this.dateFormatter=z[l.dateAxis].formatter,this.formatter=l.formatter||E.formatter,this.series=s.map(function(t,e){return new w[t.type](t,e,h)}),this.bands=(l.bands||[]).map(function(t){return new A(t)}),o=t.max(this.series.map(function(t){return t.invisible?0:t.max()}))||1,this.tickFormat=l.tickFormat||",",this.yRange=l.yRange||[l.yBase||0,o],this.xTickPadding=l.xTickPadding||0,this.tooltip=l.tooltip||E.tooltip,this.tooltip&&(this.el.on("mousemove",r(function(){if(h.x){var e,i,s,r,n=this,l=a(n);e=Math.round(h.x.invert(t.event.pageX-l.left));var o=h.timeScaleTicks&&h.timeScaleTicks.length-1;o&&(e=Math.min(Math.max(e,0),o)),i=h.x(e),s=h.tooltipData(e),s.series&&(r=h.tooltip(h,s)),r&&(h.scrubber.style({height:h.y.range()[0]-h.y.range()[1]+"px",visibility:"visible",left:i+"px",top:h.y.range()[1]+"px"}),E.showTooltip({body:r,target:h.scrubber.node(),chart:h.el.node()}))}},50)),this.el.on("mouseleave",n(function(){E.hideTooltip({target:h.scrubber.node()}),h.scrubber.style("visibility","hidden")},100)))},p.prototype={draw:function(){var e,i,s,a,r,n,o,h,c=this,u=t.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("linear"),d=4.5,p=5;if(this.el.html("").classed("shart-series-graph",!0).style("width","").style("height",""),this.width=e=parseInt(this.el.style("width"),10)||600,this.height=i=parseInt(this.el.style("height"),10)||180,(this.dateAxis||this.xAxis)&&this.el.classed("x-axis",!0),this.dateAxis||this.xAxis?(s=[M+this.xTickPadding,e-M-this.xTickPadding],r=[M,e-M]):(s=[this.xTickPadding,e-this.xTickPadding],r=[0,e]),this.yAxis?(this.el.classed("y-axis",!0),a=[i-D,D]):a=[i,0],n="none"!==this.dateAxis?t.time.scale:t.scale.linear,this.svg=this.el.append("svg:svg").attr("width",e).attr("height",i),this.x=t.scale.linear().domain([0,this.series[0].cardinality-1]).rangeRound(s),this.x_axis=t.scale.linear().domain([0,this.series[0].cardinality-1]).rangeRound(r),this.y=t.scale.linear().domain(this.yRange).rangeRound(a),this.timeScale=n().domain([this.startTime,this.endTime]).range(s),this.timeScaleTicks=l(this.timeScale.ticks(this.ticks.x).concat([this.endTime]),!0,function(t){return t.valueOf()}),this.dateAxis||this.xAxis){var f=this.svg.append("svg:g");o={x:this.x_axis(0),y:this.y(this.yRange[0])+d},h={x:this.x_axis.range()[1]+d,y:o.y},f.append("svg:path").attr("d",u([o,h])).attr({"stroke-width":1,stroke:"#aaaaaa"}),this.timeScaleTicks.forEach(function(t,e){this.xAxis&&(t=this.xAxis[e]);var i;if(i="daily"===this.dateAxis&&t.getDay?1===t.getDay():e%this.ruleTicks.x===0){var s=Math.round(this.x(e))+.5,a={x:s,y:this.y(this.yRange[0])+p+d},r={x:s,y:this.y(this.yRange[0])+d};f.append("svg:path").attr("d",u([a,r])).attr("stroke-width",1).attr("stroke","#aaaaaa"),f.append("svg:text").text(this.dateFormatter(t)).attr("x",s).attr("y",a.y+6).attr("font-size",9).attr("text-anchor","middle").attr("fill","#333")}},this)}if(this.yAxis){var g,m=this.yAxis instanceof Array,v=t.scale.linear().domain([0,this.y.domain()[1]-this.y.domain()[0]]).range(this.y.range()),y=this.svg.append("svg:g");if(m)g=this.yAxis,o={x:this.x_axis.range()[1]+d,y:v(0)+d},h={x:o.x,y:v.range()[1]},y.append("svg:path").attr("d",u([o,h]));else{var x=this.y.domain();g=t.max(x)-t.min(x)<2&&"%"!==this.tickFormat?x:[this.y.domain()[0],Math.round(this.y.domain()[1]/2*100)/100,this.y.domain()[1]],o={x:this.x_axis.range()[1]+d,y:this.y(0)+d},h={x:o.x,y:this.y.range()[1]}}y.append("svg:path").attr("d",u([o,h])).attr("stroke-width",1).attr("stroke","#aaaaaa");var b=Math.floor((this.y.domain()[1]-this.y.domain()[0])/(g.length-1));g.forEach(function(e,i){if(null!==e){var s,a,r,n=t.format(this.tickFormat);s=m?Math.round(v(i*b))+.5:Math.round(this.y(e))+.5,o={x:this.x_axis.range()[1]+d,y:s},h={x:o.x+p,y:o.y},a=y.append("svg:path").attr("d",u([o,h])).attr("stroke-width",1).attr("stroke","#aaaaaa"),r="string"==typeof e?t.requote(e):n(e),y.append("svg:text").text(r).attr("x",h.x+2).attr("y",s).attr("font-size",9).attr("text-anchor","right").attr("alignment-baseline","middle").attr("fill","#333")}},this)}return this.bands.forEach(function(t){t.draw(this)},this),this.series.forEach(function(t){t.draw(this)},this),this.scrubber=this.el.append("div").classed("shart-scrubber",!0),c},tooltipData:function(t){var e,i={},s=[];try{e=this.timeScaleTicks[t]}catch(a){}return e&&(i.date=e,i.formatted_date=this.dateFormatter(i.date)),this.series.forEach(function(e){s=s.concat(u(e,t))}),i.series=s,i}},f=function(e,s,a){a=a||{},this.id=i(),this.el=t.select(e),this.width=a.width||120,this.height=a.height||40,this.yGuides=a.y_guides||[],a.y_guide&&this.yGuides.push(a.y_guide),this.strokeColor=a.stroke_color||a.color||"blue",this.strokeWidth=a.stroke_width||1,this.series=s||[]},f.prototype.draw=function(){var e={left:0,top:2,right:0,bottom:2},i=this.width,s=this.height,a=this.yGuides,r=this.series,n=this.strokeColor,l=this.strokeWidth,o=t.max(r),h=t.min([0].concat(r)),c=r.length,u=t.scale.linear().domain([0,c-1]).range([e.left,i-e.left-e.right]),d=t.scale.linear().domain([h,o]).range([s-e.top-e.bottom,e.top]),p=t.svg.line().x(function(t,e){return u(e)}).y(function(t){return d(t)}),f=this.el.classed("shart-sparkline-graph",!0).html(""),g=f.append("svg").attr("width",i).attr("height",s);g.append("clipPath").attr("id","clip").append("rect").attr("x",0).attr("y",0).attr("width",i).attr("height",s),g.selectAll(".shart-sparkline-graph-y-guide").data(a).enter().append("line").classed("shart-sparkline-graph-y-guide",!0).attr("clip-path","url(#clip)").attr("x1",u(0)).attr("y1",function(t){return Math.floor(d(t))+.5}).attr("x2",u(c-1)).attr("y2",function(t){return Math.floor(d(t))+.5}).attr("fill","none").attr("stroke","#ddd").attr("stroke-width",1).attr("stroke-linecap","butt"),g.append("path").classed("shart-sparkline-graph-stroke",!0).attr("clip-path","url(#clip)").attr("d",p(r)).attr("fill","none").attr("stroke",n).attr("stroke-width",l).attr("stroke-linecap","butt")},g=function(e,s,a){a=a||{},this.id=i(),this.el=t.select(e),this.size=a.size||50,this.series=s},g.prototype.sequenceData=function(){var e=t.layout.pie().value(function(t){return t.value})(this.series);return this.sequenceData=function(){return e},e},g.prototype.draw=function(){var e=this.size,i=e/2-1,s=t.svg.arc().outerRadius(i),a=this.sequenceData(),r=this.el.classed("shart-pie-graph",!0).style({position:"relative",width:this.size+"px",height:0,"padding-bottom":this.size+"px"}).html(""),n=r.append("svg:svg").attr("width",this.size).attr("height",this.size).attr("viewBox",[0,0,e,e].join(" ")).style({position:"absolute",left:0,top:0});a.forEach(function(t,e){if(0!==t.value){var a=this.series[e].color||E.colors(e).toString();n.append("svg:path").attr("d",s(t)).attr("transform","translate("+(i+1)+","+(i+1)+")").attr("fill",a).attr("stroke",a)}},this)},m=function(e,a,r){r=r||{},this.id=i(),this.el=t.select(e),this.size=r.size||parseInt(this.el.style("width"),10),this.radius=this.size/2,this.thickness=r.thickness||Math.round(this.radius/7),this.value=r.value,this.value_text="undefined"==typeof r.value_text?s(this.value):r.value_text,this.value_color=r.value_color,this.label=r.label,this.label_position=r.label_position||"center",this.label_color=r.label_color,this.label_subtext=r.label_subtext,this.color=r.color||"gray",this.total=r.total,this.series=a,this.series&&this.series&&this.series.length||(this.series=[{value:this.value,color:this.color}]),this.type=r.type||"small"},m.prototype.draw=function(){for(var e,i,s=t.layout.pie().sort(null).startAngle(0).value(function(t){return t.value}),a=this.series,r=this.total,n=this.radius-this.thickness,l=this.radius,o=function(){return t.svg.arc().innerRadius(n).outerRadius(l)},h=0,c=0;c<a.length;c++)h+=a[c].value;this.total?s.endAngle(2*Math.PI*h/r):r=h,this.el.classed("shart-donut-graph",!0).style("width",this.size+"px").style("height",this.size+"px").html(""),this.type&&this.el.classed(this.type,!0);var u=this.el.append("div").style("position","relative").style("width",this.size+"px").style("height",this.size+"px"),d=u.append("svg:svg").attr("width",this.size).attr("height",this.size);if(d.append("svg:path").classed("shart-donut-graph-background",!0).attr("fill","#e5e5e5").attr("transform","translate("+this.radius+","+this.radius+")").attr("d",o().startAngle(0).endAngle(2*Math.PI)()),d.append("svg:g").selectAll(".shart-donut-graph-arc").data(s(this.series)).enter().append("svg:path").classed("shart-donut-graph-arc",!0).attr("transform","translate("+this.radius+","+this.radius+")").attr("fill",function(t){return t.data.color}).attr("d",o()),this.label&&"center"===this.label_position){var p=u.append("div").style("position","absolute").style("display","table").style("top",this.thickness+"px").style("left",this.thickness+"px").style("width",this.size-2*this.thickness+"px").style("height",this.size-2*this.thickness+"px"),f=p.append("div").style("display","table-cell").style("text-align","center").style("vertical-align","middle");e=f.append("div").classed("shart-donut-graph-value",!0).text(this.value_text),i=f.append("div").classed("shart-donut-graph-label",!0).style("text-align","center").text(this.label)}else{e=u.append("div").classed("shart-donut-graph-value",!0).style("white-space","nowrap").style("overflow","visible").style("display","inline-block").text(this.value_text);var g={width:parseInt(e.style("width"),10),height:parseInt(e.style("height"),10)};if(e.style("position","absolute").style("left",(this.size-g.width)/2+"px").style("top",(this.size-g.height)/2+"px"),this.label){var m=this.size;i=u.append("div").classed("shart-donut-graph-label",!0).style("white-space","nowrap").style("overflow","visible").style("display","inline-block").text(this.label),this.label_subtext&&(i.node().appendChild(document.createTextNode(" ")),i.append("span").classed("shart-donut-graph-label-subtext",!0).text(this.label_subtext));var v={width:parseInt(i.style("width"),10),height:parseInt(i.style("height"),10)},y=v.height/2;i.style("position","absolute").style("left",this.size+y+"px").style("top",(this.size-v.height)/2+"px"),m+=y+v.width,d.attr("width",m+"px"),this.el.style("width",m+"px")}e&&this.value_color&&e.style("color",this.value_color),i&&this.label_color&&i.style("color",this.label_color)}},v=function(e,s,a){a=a||{},this.id=i(),this.el=t.select(e),this.size=a.size||44,this.thickness=a.thickness,this.total=a.total,this.label_subtext=a.label_subtext||"",this.series=s},v.prototype.draw=function(){var t,e=this.series,i=this.total;if(!i)for(i=0,t=0;t<e.length;t++)i+=e[t].value;for(this.el.classed("shart-donut-stack-graph",!0).html(""),t=0;t<e.length;t++){var a=this.el.append("div").classed("shart-donut-stack-graph-item",!0),r=s(e[t].value);this.label_subtext&&(r+=" "+this.label_subtext);var n=new m(a.node(),[],{total:i,value:e[t].value,value_text:s(Math.round(100*e[t].value/i))+"%",value_color:e[t].color,label:e[t].label,label_position:"right",label_subtext:r,color:e[t].color,size:this.size,thickness:this.thickness});n.el.classed("shart-donut-stack-graph-item-donut-graph"),n.draw()}},y=function(e,s,a){a=a||{},this.id=i(),this.el=t.select(e),this.series=s,this.percentages=a.percentages},y.prototype.draw=function(){var e=t.sum(this.series,function(t){return t.value}),i=t.scale.linear().domain([0,t.max(this.series,function(t){return t.value})]).range([0,100]),s=t.scale.linear().domain([0,e]).range([0,100]);this.el.classed("shart-horizontal-bar-graph",!0);var a=this.el.selectAll(".shart-horizontal-bar-graph-segment").data(this.series).enter().append("div").classed("shart-horizontal-bar-graph-segment",!0),r=a.append("div").classed("shart-horizontal-bar-graph-label",!0);r.text(this.percentages?function(t){var i=Math.round(s(t.value||0));return 0===e&&(i="--"),i+"% "+t.label}:function(t){return t.label}),r.append("span").classed("shart-horizontal-bar-graph-label-subtext",!0).text(function(t){return t.label_subtext}),a.append("div").classed("shart-horizontal-bar-graph-value",!0).append("div").classed("shart-horizontal-bar-graph-value-bar",!0).style("background-color",function(t){return t.color}).style("width",function(t){return i(t.value||0)+"%"}).style("min-width","1px")},x=function(e,s,a){a=a||{},this.id=i(),this.el=t.select(e),this.series=s,this.svg=this.el.append("svg"),this.labels=!!s[0].label,this.label_subtext=!!s[0].label_subtext,this.colors=a.colors||E.colors,this.tooltip=a.tooltip||E.tooltip,this.formatter=a.formatter||E.formatter},x.prototype={draw:function(){var e,i,s=this,a=s.svg,r=35,n={label:18,label_subtext:16,bar:r+8},l=t.sum(this.series,function(t){return t.value}),o=0===l,h=function(e){return t.format("%")(e)};this.el.classed("shart-pipeline-graph",!0),a.attr("width",0),e=s.width=parseInt(this.el.style("width"),10),i=s.height=n.label+n.label_subtext+n.bar,a.attr("width",e).attr("height",i),o&&a.attr("opacity","0.25"),this.svg.html("");var c=0,u=this.series.length-1;this.series.forEach(function(t,e,i){t.x=c,t.percentage=o?1/i.length:t.value/l,t.width=e===u?s.width-c:Math.floor(t.percentage*s.width),t.color=t.color||s.colors(e),c+=t.width});var d=a.append("defs").selectAll("clipPath").data(this.series);d.enter().append("clipPath").attr("id",function(t,e){return"clip-"+s.id+"-"+e}).append("rect").attr("width",function(t){return t.width}).attr("height",i),d.exit().remove();var p=a.selectAll(".shart-pipeline-graph-item").data(this.series);p.exit().remove();var f=p.enter().append("g").attr("class","shart-pipeline-item").attr("transform",function(t){return"translate("+t.x+",0)"}).attr("clip-path",function(t,e){return"url(#clip-"+s.id+"-"+e+")"});this.labels?f.append("text").attr("class","shart-pipeline-item-label").attr("x",2).attr("y",n.label).text(function(t){var e=h(t.percentage);return o&&(e="--%"),e+" "+t.label}):n.label=0,this.label_subtext?f.append("text").attr("class","shart-pipeline-item-label-subtext").attr("x",2).attr("y",n.label+n.label_subtext).text(function(t){return t.label_subtext}):n.label_subtext=0,this.height=i=n.label+n.label_subtext+n.bar,a.attr("height",i),f.append("rect").attr("class","shart-pipeline-item-bar").attr("fill",function(t){return t.color}).attr("y",n.label+n.label_subtext+n.bar-r).attr("width",function(t){return t.width}).attr("height",r),this.attachMouseEvents()},attachMouseEvents:function(){var e=this,i=e.svg,s=-1;this.el.on("mousemove",r(function(){var a=t.mouse(i.node())[0],r=i.selectAll(".shart-pipeline-graph-item");r.each(function(i,n){var l=t.select(this),o=l.select("rect"),h=parseInt((/\d+/.exec(l.attr("transform"))||["0"])[0],10),c=parseInt(o.attr("width"),10);if(n!==s&&a>=h&&h+c>a){if(s>-1){var u=r.filter(function(t,e){return e===s});e.mouseleave(u,u.datum(),s)}e.mouseenter(l,i,n),s=n}})},40)),this.el.on("mouseleave",function(){if(s>-1){var t=i.selectAll(".shart-pipeline-graph-item"),a=t.filter(function(t,e){return e===s});e.mouseleave(a,a.datum(),s),s=-1}}),this.attachMouseEvents=function(){}},mouseenter:function(e,i,s){var a,r=this,n=this.svg,l=i.color,o=10,h=0;if(e.select("rect").attr("fill",t.lab(l).brighter(.3).toString()),this.labels&&this.label_subtext?h=Math.max(e.select(".shart-pipeline-graph-item-label").node().getComputedTextLength(),e.select(".shart-pipeline-graph-item-label-subtext").node().getComputedTextLength())+o:(this.labels&&(h=e.select(".shart-pipeline-graph-item-label").node().getComputedTextLength()+o),this.label_subtext&&(h=e.select(".shart-pipeline-graph-item-label-subtext").node().getComputedTextLength()+o)),h=Math.ceil(h),i.width<h){var c=i.width,u=h-c,d=n.selectAll(".shart-pipeline-graph-item"),p=0,f=d[0].length-1;d.each(function(e,i){var a=t.select(this),l=a.select("rect"),o=n.select("#clip-"+r.id+"-"+i).select("rect"),c=i===s?h:Math.floor(e.percentage*(r.width-u));i===f&&(c=r.width-p),a.transition().duration(200).attr("transform","translate("+p+",0)"),l.transition().duration(200).attr("width",c),o.transition().duration(200).attr("width",c),p+=c})}i.formatted_value||(i.formatted_value=this.formatter(i.value)),a=r.tooltip(r,{series:[i]}),a&&E.showTooltip({body:a,position:"bottom",target:e.select("rect").node(),chart:r.el.node()})},mouseleave:function(e,i,s){var a=this,r=this.svg,n=parseInt(r.select("#clip-"+a.id+"-"+s).select("rect").attr("width"),10),l=i.color;if(i.width<n){var o=r.selectAll(".shart-pipeline-graph-item");o.each(function(e,i){var s=t.select(this),n=s.select("rect"),l=r.select("#clip-"+a.id+"-"+i).select("rect");s.transition().duration(200).attr("transform","translate("+e.x+",0)"),n.transition().duration(200).attr("width",e.width),l.transition().duration(200).attr("width",e.width)})}e.select("rect").attr("fill",l),E.hideTooltip({target:e.select("rect").node()})}},b=function(e,i){this.el=t.select(e),this.series=i},b.prototype.draw=function(){this.el.classed("shart-legend",!0),this.update(this.series)},b.prototype.update=function(t,e){this.series=t;var i=this.el.selectAll(".shart-legend-item").data(t),s=i.exit(),a=i.enter().append("div").classed("shart-legend-item",!0);a.filter(function(t){return!!t.color}).append("span").classed("shart-swatch shart-legend-item-swatch",!0).style("background-color",function(t){return t.color}),a.append("span").classed("shart-legend-item-label",!0).text(function(t){return t.label}),a.append("span").classed("shart-legend-item-value",!0).text(function(t){return t.formatted_value||t.value}),e?(s.transition().style("opacity",0).remove(),a.style("opacity",0).transition().duration(1e3).style("opacity",1)):s.remove()};var F=0;E.colors=t.scale.category10();var L=t.format(",");return E.formatter=function(t){return t||0===t?L(t):"--"},E.showTooltip=function(){},E.hideTooltip=function(){},E.tooltip=function(e,i){var s,a,r,n,l=t.select(document.createElement("div")),o=c(i.series);if(1===o.length){var h=o[0];s=l.append("div").classed("shart-tip-placard",!0),s.append("div").classed("shart-tip-placard-value",!0).text(h.formatted_value||h.value),s.append("div").classed("shart-tip-placard-label",!0).text(h.tip_label||h.label)}else a=l.append("div"),n=new b(a.node(),o),n.draw();return i.date&&(r=l.append("div").classed("shart-tip-date",!0).text(e.dateFormatter(i.date))),l.node()},E.configure=function(t){var e={};t(e),E.colors=e.colors||E.colors,E.showTooltip=e.showTooltip||E.showTooltip,E.hideTooltip=e.hideTooltip||E.hideTooltip,E.tooltip=e.tooltip||E.tooltip,E.formatter=e.formatter||E.formatter},E.Legend=function(t,e,i){var s=new b(t,e,i);return s.draw(),s},E.Series=function(t,e,i){var s=new p(t,e,i);return d(s),s.draw(),s},E.Sparkline=function(t,e,i){var s=new f(t,e,i);return s.draw(),s},E.Pie=function(t,e,i){var s=new g(t,e,i);return s.draw(),s},E.Donut=function(t,e,i){var s=new m(t,e,i);return d(s),s.draw(),s},E.DonutStack=function(t,e,i){var s=new v(t,e,i);return d(s),s.draw(),s},E.HorizontalBar=function(t,e,i){var s=new y(t,e,i);return d(s),s.draw(),s},E.Pipeline=function(t,e,i){var s=new x(t,e,i);return d(s),s.draw(),s},E}(),e.Shart=c}(d3,window);